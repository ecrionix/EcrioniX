<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Osmosis & Diffusion Lab - EcrioniX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@500;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        .read-font { font-family: 'Merriweather', serif; }

        /* Mobile Scroll */
        @media (max-width: 1024px) { body { overflow-y: auto; } }

        .watermark {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900; color: rgba(56, 189, 248, 0.03); /* Cyan tint */
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
        }

        /* Tabs */
        .tab-btn {
            @apply px-4 py-2 text-xs font-bold rounded-lg transition-all border border-transparent text-slate-400 uppercase tracking-wider;
        }
        .tab-active {
            @apply bg-cyan-600 text-white border-cyan-500 shadow-lg shadow-cyan-500/30;
        }

        /* Simulation Canvas */
        #sim-canvas {
            background-color: #0f172a;
            border-radius: 12px;
            width: 100%; height: 100%;
        }

        /* Theory Typography */
        .prose h1 { @apply text-3xl font-bold text-white mb-6 tech-font border-b border-slate-800 pb-2; }
        .prose h2 { @apply text-xl font-bold text-cyan-400 mt-10 mb-4 uppercase tracking-wider; }
        .prose p { @apply text-slate-300 mb-4 leading-relaxed text-sm md:text-base font-light; }
        .prose strong { @apply text-white font-bold; }
        .prose ul { @apply list-disc list-inside space-y-2 text-slate-400 mb-4 ml-4; }
        .prose .highlight-box { @apply bg-slate-900/50 border-l-4 border-cyan-500 p-4 my-6 rounded-r-lg; }

        input[type=range] { accent-color: #06b6d4; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <div class="watermark">EcrioniX BioPhysics</div>

    <!-- Header -->
    <nav class="border-b border-slate-800 bg-slate-900/80 px-4 md:px-6 py-3 md:py-4 flex justify-between items-center z-20 sticky top-0 backdrop-blur-md">
        <div>
            <h1 class="text-xl md:text-2xl font-bold text-cyan-400 tech-font uppercase">OSMOSIS <span class="text-white">& DIFFUSION</span></h1>
            <p class="text-[9px] md:text-[10px] text-slate-500 uppercase tracking-widest font-bold hidden md:block">Passive Transport Mechanisms</p>
        </div>
        
        <div class="flex bg-slate-950 p-1 rounded-xl border border-slate-800">
            <button onclick="switchView('theory')" id="btn-theory" class="tab-btn tab-active">Theory Guide</button>
            <button onclick="switchView('lab')" id="btn-lab" class="tab-btn">Simulation Lab</button>
        </div>

        <button onclick="window.history.back()" class="group flex items-center text-slate-400 hover:text-white transition bg-slate-800/80 px-3 py-2 rounded-lg border border-slate-700 hover:border-cyan-500 ml-2">
            <span class="text-xs font-bold uppercase hidden md:inline">Exit Lab</span>
            <span class="text-xs font-bold uppercase md:hidden">Exit</span>
        </button>
    </nav>

    <!-- Content -->
    <div class="flex-grow relative overflow-y-auto lg:overflow-hidden">

        <!-- THEORY VIEW -->
        <div id="view-theory" class="absolute inset-0 z-10 overflow-y-auto custom-scroll p-4 md:p-8 flex justify-center">
            <div class="max-w-4xl w-full glass-panel p-6 md:p-10 prose mb-10 read-font">
                <h1>The Physics of Movement in Cells</h1>
                <p>
                    Life depends on the movement of molecules. Nutrients must enter cells, and waste must leave. While some transport requires energy (Active Transport), much of it happens passively through the physical laws of **Diffusion** and **Osmosis**.
                </p>

                <h2>1. Diffusion: The Spreading Out</h2>
                <p>
                    <strong>Definition:</strong> The net movement of particles from an area of **high concentration** to an area of **low concentration**.
                </p>
                <div class="highlight-box">
                    <p class="text-white italic">"Nature hates a gradient."</p>
                </div>
                <p>
                    Imagine opening a bottle of perfume in a room. The scent molecules are highly concentrated in the bottle. Over time, they bounce off air molecules and spread out until they are evenly distributed throughout the room. This state of equal distribution is called **Equilibrium**.
                </p>
                <h3>Factors affecting Rate of Diffusion:</h3>
                <ul>
                    <li><strong>Concentration Gradient:</strong> The steeper the difference, the faster the flow.</li>
                    <li><strong>Temperature:</strong> Higher heat means particles have more kinetic energy and move faster.</li>
                    <li><strong>Surface Area:</strong> More space allows more particles to pass through at once.</li>
                </ul>

                <h2>2. Osmosis: The Special Case of Water</h2>
                <p>
                    <strong>Definition:</strong> The net movement of **water molecules** across a **semi-permeable membrane** from an area of low solute concentration (high water potential) to an area of high solute concentration (low water potential).
                </p>
                <p>
                    Think of a cell membrane. It lets water pass freely but blocks large molecules like salt or sugar. If you put a cell in salty water, the water inside the cell "wants" to leave to dilute the salt outside. This can cause the cell to shrivel.
                </p>

                <h3>Tonicity Types:</h3>
                <ul>
                    <li><strong>Hypertonic Solution:</strong> Higher solute concentration outside. Water leaves cell. (Cell shrinks/plasmolysis).</li>
                    <li><strong>Hypotonic Solution:</strong> Lower solute concentration outside. Water enters cell. (Cell swells/lyses).</li>
                    <li><strong>Isotonic Solution:</strong> Equal concentration. No net movement.</li>
                </ul>

                <h2>3. Fick's First Law</h2>
                <p>
                    Mathematically, diffusion flux ($J$) is described by Fick's Law:
                </p>
                <div class="highlight-box">
                    <p class="text-center text-xl text-white font-mono">
                        \[ J = -D \frac{d\phi}{dx} \]
                    </p>
                </div>
                <p>
                    Where $D$ is the diffusion coefficient, and $d\phi/dx$ is the concentration gradient. The negative sign indicates movement down the gradient.
                </p>

                <div class="mt-12 text-center pb-8">
                    <button onclick="switchView('lab')" class="bg-cyan-600 hover:bg-cyan-500 text-white px-8 py-3 rounded-xl font-bold transition shadow-lg shadow-cyan-500/20 font-sans">Start Experiment &rarr;</button>
                </div>
            </div>
        </div>

        <!-- LAB VIEW -->
        <div id="view-lab" class="absolute inset-0 z-0 opacity-0 pointer-events-none flex flex-col lg:flex-row p-4 lg:p-6 gap-6 overflow-y-auto lg:overflow-hidden">
            
            <!-- Left: Controls -->
            <div class="w-full lg:w-80 flex flex-col gap-4 flex-shrink-0">
                <div class="glass-panel p-6">
                    <h2 class="text-cyan-400 font-bold mb-4 uppercase text-[10px] tracking-widest">Environment Config</h2>
                    
                    <div class="space-y-6">
                        <!-- Mode Select -->
                        <div>
                            <span class="text-xs text-slate-300 font-bold block mb-2">Experiment Mode</span>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="setMode('DIFFUSION')" id="btn-diff" class="py-2 bg-cyan-600 text-white rounded border border-cyan-500 text-xs font-bold transition shadow">DIFFUSION</button>
                                <button onclick="setMode('OSMOSIS')" id="btn-osm" class="py-2 bg-slate-800 text-slate-400 rounded border border-slate-700 text-xs font-bold transition hover:text-white">OSMOSIS</button>
                            </div>
                        </div>

                        <!-- Solute Amount -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300">Solute (Left Side)</span>
                                <span id="val-solute" class="font-mono text-white font-bold">50</span>
                            </div>
                            <input type="range" id="slider-solute" min="0" max="200" step="10" value="50" class="w-full">
                        </div>

                        <!-- Temperature -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300">Temperature (KE)</span>
                                <span id="val-temp" class="font-mono text-white font-bold">25°C</span>
                            </div>
                            <input type="range" id="slider-temp" min="0" max="100" step="1" value="25" class="w-full">
                        </div>

                        <button onclick="resetLab()" class="w-full py-2 text-xs font-bold text-red-400 border border-red-900/30 rounded hover:bg-red-900/10">RESET SYSTEM</button>
                    </div>
                </div>

                <!-- Analysis -->
                <div class="glass-panel p-6 flex-grow flex flex-col">
                    <h2 class="text-emerald-400 font-bold mb-4 uppercase text-[10px] tracking-widest">Real-time Data</h2>
                    <div class="space-y-3">
                        <div class="bg-black/40 p-3 rounded border border-slate-800 flex justify-between items-center">
                            <span class="text-xs text-slate-400">Equilibrium Status</span>
                            <span id="stat-eq" class="text-yellow-400 font-bold text-xs animate-pulse">IMBALANCED</span>
                        </div>
                        <div class="bg-black/40 p-3 rounded border border-slate-800 flex justify-between items-center">
                            <span class="text-xs text-slate-400">Conc. Left</span>
                            <span id="stat-c-left" class="text-white font-mono font-bold">0%</span>
                        </div>
                        <div class="bg-black/40 p-3 rounded border border-slate-800 flex justify-between items-center">
                            <span class="text-xs text-slate-400">Conc. Right</span>
                            <span id="stat-c-right" class="text-white font-mono font-bold">0%</span>
                        </div>
                    </div>

                    <div class="flex-grow mt-4 relative bg-black/20 rounded border border-slate-800 h-32">
                        <canvas id="conc-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Right: Visualization -->
            <div class="flex-grow flex flex-col gap-6 min-h-[500px] lg:min-h-0">
                <div class="glass-panel p-1 relative flex-grow overflow-hidden flex flex-col bg-slate-900/50">
                    <div class="absolute top-4 left-4 z-10 px-3 py-1 bg-black/60 rounded text-[10px] text-slate-400 border border-slate-700 font-bold uppercase tracking-widest">
                        Microscopic View
                    </div>
                    
                    <div id="canvas-container" class="w-full h-full relative">
                        <canvas id="sim-canvas"></canvas>
                        
                        <!-- Membrane Visual -->
                        <div class="absolute top-0 bottom-0 left-1/2 w-2 bg-slate-600/50 -translate-x-1/2 flex flex-col justify-evenly items-center py-2" id="membrane">
                            <!-- Pores generated by JS -->
                        </div>

                        <!-- Labels -->
                        <div class="absolute bottom-4 left-1/4 text-white/20 font-bold text-4xl select-none">LEFT</div>
                        <div class="absolute bottom-4 right-1/4 text-white/20 font-bold text-4xl select-none">RIGHT</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- State ---
        let mode = 'DIFFUSION'; // DIFFUSION or OSMOSIS
        let soluteCount = 50;
        let temperature = 25; // 0-100
        let speedFactor = 1.0;
        
        let particles = []; // {x, y, vx, vy, type, size, color}
        const WATER_COUNT = 300;
        
        // Chart Data
        let chart;
        let historyL = [];
        let historyR = [];

        // DOM
        const canvas = document.getElementById('sim-canvas');
        const ctx = canvas.getContext('2d');
        const membrane = document.getElementById('membrane');

        // --- Init ---
        function switchView(v) {
            const theory = document.getElementById('view-theory');
            const lab = document.getElementById('view-lab');
            const btnT = document.getElementById('btn-theory');
            const btnL = document.getElementById('btn-lab');

            if (v === 'theory') {
                theory.classList.remove('opacity-0', 'pointer-events-none'); theory.classList.add('z-10');
                lab.classList.add('opacity-0', 'pointer-events-none'); lab.classList.remove('z-10');
                btnT.classList.add('tab-active'); btnL.classList.remove('tab-active');
            } else {
                lab.classList.remove('opacity-0', 'pointer-events-none'); lab.classList.add('z-10');
                theory.classList.add('opacity-0', 'pointer-events-none'); theory.classList.remove('z-10');
                btnL.classList.add('tab-active'); btnT.classList.remove('tab-active');
                resize();
            }
        }

        function setMode(m) {
            mode = m;
            document.getElementById('btn-diff').className = m==='DIFFUSION' ? "py-2 bg-cyan-600 text-white rounded border border-cyan-500 text-xs font-bold transition shadow" : "py-2 bg-slate-800 text-slate-400 rounded border border-slate-700 text-xs font-bold transition hover:text-white";
            document.getElementById('btn-osm').className = m==='OSMOSIS' ? "py-2 bg-cyan-600 text-white rounded border border-cyan-500 text-xs font-bold transition shadow" : "py-2 bg-slate-800 text-slate-400 rounded border border-slate-700 text-xs font-bold transition hover:text-white";
            resetLab();
        }

        document.getElementById('slider-solute').addEventListener('input', (e) => {
            soluteCount = parseInt(e.target.value);
            document.getElementById('val-solute').innerText = soluteCount;
            resetLab(); // Respawn on count change for simplicity
        });

        document.getElementById('slider-temp').addEventListener('input', (e) => {
            temperature = parseInt(e.target.value);
            document.getElementById('val-temp').innerText = temperature + "°C";
            // Update speed of existing particles
            speedFactor = 0.5 + (temperature / 50);
        });

        function resize() {
            if(canvas.parentElement) {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
                initMembrane();
            }
        }
        window.addEventListener('resize', resize);

        function initMembrane() {
            membrane.innerHTML = '';
            const pores = Math.floor(canvas.height / 20);
            for(let i=0; i<pores; i++) {
                const pore = document.createElement('div');
                // Osmosis: Small pores (water only). Diffusion: Large pores (both).
                pore.className = mode === 'OSMOSIS' ? "w-1 h-1 bg-black rounded-full" : "w-1 h-3 bg-black rounded-full";
                membrane.appendChild(pore);
            }
        }

        function resetLab() {
            particles = [];
            historyL = []; historyR = [];
            
            // Spawn Water (Blue) - Evenly distributed initially
            for(let i=0; i<WATER_COUNT; i++) {
                const side = Math.random() > 0.5 ? 1 : 0; // 0=Left, 1=Right
                const x = side === 0 ? Math.random() * (canvas.width/2 - 20) : (canvas.width/2 + 20) + Math.random() * (canvas.width/2 - 20);
                particles.push({
                    x: x,
                    y: Math.random() * canvas.height,
                    vx: (Math.random()-0.5),
                    vy: (Math.random()-0.5),
                    type: 'water',
                    color: '#3b82f6',
                    size: 3
                });
            }

            // Spawn Solute (Red/Green) - All on Left initially
            for(let i=0; i<soluteCount; i++) {
                particles.push({
                    x: Math.random() * (canvas.width/2 - 20),
                    y: Math.random() * canvas.height,
                    vx: (Math.random()-0.5),
                    vy: (Math.random()-0.5),
                    type: 'solute',
                    color: '#ef4444',
                    size: mode === 'OSMOSIS' ? 8 : 5 // Larger in osmosis to show blocking
                });
            }

            initMembrane();
            updateChart();
        }

        // --- Physics Engine ---
        function update() {
            const midX = canvas.width / 2;
            const membraneGap = mode === 'OSMOSIS' ? 4 : 10; // "Physical" gap size logic approximation
            
            // Count for stats
            let leftSolute = 0, rightSolute = 0;
            let leftWater = 0, rightWater = 0;

            particles.forEach(p => {
                // Move
                p.x += p.vx * speedFactor;
                p.y += p.vy * speedFactor;

                // Wall Bounce
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                // Membrane Logic
                // Check if crossing midX
                const distToMembrane = Math.abs(p.x - midX);
                
                if (distToMembrane < 5) {
                    // Collision check
                    if (p.type === 'solute' && mode === 'OSMOSIS') {
                        // Solute CANNOT pass in Osmosis (Semi-permeable)
                        // Bounce back
                        if (p.x < midX) { p.x = midX - 6; p.vx = -Math.abs(p.vx); }
                        else { p.x = midX + 6; p.vx = Math.abs(p.vx); }
                    } 
                    // Water always passes. Solute passes in Diffusion.
                }

                // Stats counting
                if (p.x < midX) {
                    if (p.type === 'solute') leftSolute++;
                    else leftWater++;
                } else {
                    if (p.type === 'solute') rightSolute++;
                    else rightWater++;
                }
            });

            updateStats(leftSolute, rightSolute, leftWater, rightWater);
        }

        function updateStats(ls, rs, lw, rw) {
            // Concentration = Solute / (Water + Solute)
            // Simplified for visual: Solute Count on each side relative to total solute
            const totalS = ls + rs;
            const cL = totalS > 0 ? (ls / totalS * 100) : 0;
            const cR = totalS > 0 ? (rs / totalS * 100) : 0;

            document.getElementById('stat-c-left').innerText = cL.toFixed(0) + "%";
            document.getElementById('stat-c-right').innerText = cR.toFixed(0) + "%";

            const diff = Math.abs(cL - cR);
            const status = document.getElementById('stat-eq');
            if (diff < 10) {
                status.innerText = "EQUILIBRIUM";
                status.className = "text-green-400 font-bold text-xs";
            } else {
                status.innerText = "IMBALANCED";
                status.className = "text-yellow-400 font-bold text-xs animate-pulse";
            }

            // Graph Data
            historyL.push(cL);
            historyR.push(cR);
            if (historyL.length > 50) { historyL.shift(); historyR.shift(); }
        }

        // --- Render ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw Particles
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.fill();
            });
        }

        // --- Chart ---
        function initChart() {
            const ctxC = document.getElementById('conc-chart').getContext('2d');
            chart = new Chart(ctxC, {
                type: 'line',
                data: {
                    labels: Array(50).fill(''),
                    datasets: [
                        { label: 'Left', data: [], borderColor: '#ef4444', borderWidth: 1, pointRadius: 0 },
                        { label: 'Right', data: [], borderColor: '#3b82f6', borderWidth: 1, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 0, max: 100, grid: { color: '#334155' } },
                        x: { display: false }
                    }
                }
            });
        }

        function updateChart() {
            if(!chart) initChart();
            chart.data.datasets[0].data = historyL;
            chart.data.datasets[1].data = historyR;
            chart.update();
        }

        // Loop
        let frame = 0;
        function loop() {
            update();
            draw();
            if(frame % 10 === 0) updateChart(); // Limit chart updates
            frame++;
            requestAnimationFrame(loop);
        }

        // Start
        resize();
        resetLab();
        loop();

    </script>
</body>
</html>
