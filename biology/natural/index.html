<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6672302762343789"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natural Selection Lab - EcrioniX Zoology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* Watermark */
        .watermark {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900;
            color: rgba(34, 197, 94, 0.03);
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* Tabs */
        .tab-btn {
            @apply px-6 py-3 font-bold text-sm transition-all duration-300 border-b-2 border-transparent text-slate-400;
        }
        .tab-active {
            @apply border-green-500 text-white bg-green-500/10;
        }

        /* Simulation Canvas */
        #forest-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
            background-color: #1e293b; /* Base wood color */
            transition: background-color 1s ease;
        }

        /* UI Elements */
        input[type=range] { accent-color: #22c55e; }
        
        .moth {
            position: absolute;
            width: 24px;
            height: 16px;
            pointer-events: auto;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .prose h1 { @apply text-3xl font-bold text-white mb-6 tech-font border-b border-slate-800 pb-2; }
        .prose h2 { @apply text-xl font-bold text-green-400 mt-8 mb-4 uppercase tracking-wider; }
        .prose p { @apply text-slate-400 mb-4 leading-relaxed; }
        .prose strong { @apply text-white font-semibold; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <div class="watermark">EcrioniX Zoology</div>

    <!-- Header -->
    <nav class="border-b border-slate-800 bg-slate-900/80 px-6 py-3 flex justify-between items-center z-50">
        <div class="flex items-center gap-8">
            <div>
                <h1 class="text-xl font-bold text-green-400 tech-font uppercase">Zoology <span class="text-white">Lab</span></h1>
            </div>
            <div class="flex">
                <button onclick="switchView('theory')" id="btn-view-theory" class="tab-btn tab-active">THEORY OVERVIEW</button>
                <button onclick="switchView('lab')" id="btn-view-lab" class="tab-btn">NATURAL SELECTION SIM</button>
            </div>
        </div>
        
        <!-- Mandatory Exit Option -->
        <button onclick="window.history.back()" class="group flex items-center text-slate-400 hover:text-white transition bg-slate-800/80 px-4 py-2 rounded-lg border border-slate-700 hover:border-green-500">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            <span class="text-xs font-bold uppercase">Exit Lab</span>
        </button>
    </nav>

    <!-- Content Area -->
    <div class="flex-grow overflow-hidden relative">
        
        <!-- VIEW 1: THEORY -->
        <div id="section-theory" class="absolute inset-0 z-10 overflow-y-auto p-8 flex justify-center">
            <div class="max-w-4xl w-full glass-panel p-10 prose">
                <h1>Natural Selection in Action</h1>
                <p>
                    Zoology isn't just the study of animal anatomy; it is the study of how animals adapt to survive. One of the most famous examples of evolution is the <strong>Peppered Moth (Biston betularia)</strong>.
                </p>

                <h2>1. Variation and Heredity</h2>
                <p>
                    Within any population, individuals have different traits. In 19th-century England, peppered moths were mostly light-colored with dark spots, which helped them hide on light-colored, lichen-covered trees. A rare dark (melanic) variation also existed.
                </p>

                <h2>2. The Selective Pressure</h2>
                <p>
                    During the Industrial Revolution, soot from coal-burning factories killed the lichens and blackened the tree trunks. Suddenly, the light moths were easily spotted by birds, while the dark moths were now camouflaged.
                </p>

                <div class="bg-green-500/5 border-l-4 border-green-500 p-6 my-6">
                    <p class="text-white font-medium italic mb-2">Darwin's Core Principle:</p>
                    <p class="text-slate-300">Individuals with traits better suited to their environment are more likely to survive and reproduce, passing those traits to the next generation.</p>
                </div>

                <h2>3. Evolutionary Shift</h2>
                <p>
                    Over several decades, the population of dark moths exploded while light moths dwindledâ€”a process called <strong>Directional Selection</strong>.
                </p>

                <div class="mt-12 text-center">
                    <button onclick="switchView('lab')" class="bg-green-600 hover:bg-green-500 text-white px-8 py-4 rounded-xl font-bold transition shadow-lg shadow-green-500/30">
                        START SIMULATION &rarr;
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW 2: LAB -->
        <div id="section-lab" class="absolute inset-0 z-0 opacity-0 pointer-events-none flex p-6 gap-6 overflow-hidden">
            
            <!-- Left: Controls -->
            <div class="w-80 flex flex-col gap-4">
                <div class="glass-panel p-6">
                    <h2 class="text-green-400 font-bold uppercase text-[10px] tracking-widest text-center mb-4">Environment Config</h2>
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-400">Industrial Pollution</span>
                                <span id="lbl-pollution" class="text-white font-bold">0%</span>
                            </div>
                            <input type="range" id="slider-pollution" min="0" max="100" value="0" class="w-full">
                        </div>
                        
                        <div class="h-px bg-slate-800"></div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-slate-400">Automatic Predation</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="check-auto" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="glass-panel p-6 flex-grow flex flex-col">
                    <h2 class="text-slate-500 font-bold uppercase text-[10px] tracking-widest mb-4">Population Analytics</h2>
                    
                    <div class="space-y-4">
                        <div class="bg-black/40 p-3 rounded-lg border border-slate-800 flex justify-between">
                            <span class="text-xs text-slate-400">Light Moths</span>
                            <span id="stat-light" class="text-white font-bold mono-font">20</span>
                        </div>
                        <div class="bg-black/40 p-3 rounded-lg border border-slate-800 flex justify-between">
                            <span class="text-xs text-slate-400">Dark Moths</span>
                            <span id="stat-dark" class="text-white font-bold mono-font">20</span>
                        </div>
                    </div>

                    <div class="flex-grow mt-6 bg-black/20 rounded border border-slate-800 overflow-hidden">
                        <canvas id="pop-chart"></canvas>
                    </div>

                    <button onclick="resetSim()" class="mt-6 w-full py-2 text-xs font-bold text-red-400 border border-red-900/30 rounded hover:bg-red-900/10">RESET POPULATION</button>
                </div>
            </div>

            <!-- Center: The Forest Bench -->
            <div class="flex-grow glass-panel relative overflow-hidden group">
                <div class="absolute top-6 left-1/2 -translate-x-1/2 px-4 py-1 bg-slate-900/80 rounded-full border border-slate-800 text-[10px] text-slate-400 font-bold uppercase tracking-widest z-10">
                    Forest Bench: Hunt the Moths to Simulate Selection
                </div>

                <div id="simulation-area" class="w-full h-full relative">
                    <!-- Bark background -->
                    <div id="forest-bg" class="w-full h-full absolute inset-0 bg-[#cbd5e1]"></div>
                    <!-- Moths will be injected here -->
                </div>

                <div class="absolute bottom-6 left-6 text-[10px] text-slate-500 italic max-w-xs leading-relaxed">
                    <strong>Tip:</strong> If "Auto-Predation" is OFF, you act as the bird. Click on moths to eat them. Notice how much harder it is to see them as the pollution level changes.
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- State ---
        let currentView = 'theory';
        let pollution = 0;
        let isAuto = true;
        let moths = [];
        let frames = 0;
        let chart;

        // Colors
        const LIGHT_MOTH = "#e2e8f0";
        const DARK_MOTH = "#1e293b";
        const LIGHT_BARK = "#cbd5e1";
        const DARK_BARK = "#0f172a";

        // --- View Logic ---
        function switchView(v) {
            currentView = v;
            document.getElementById('section-theory').style.opacity = v === 'theory' ? '1' : '0';
            document.getElementById('section-theory').style.pointerEvents = v === 'theory' ? 'auto' : 'none';
            document.getElementById('section-lab').style.opacity = v === 'lab' ? '1' : '0';
            document.getElementById('section-lab').style.pointerEvents = v === 'lab' ? 'auto' : 'none';
            document.getElementById('btn-view-theory').classList.toggle('tab-active', v === 'theory');
            document.getElementById('btn-view-lab').classList.toggle('tab-active', v === 'lab');
            
            if (v === 'lab') {
                if(!chart) initChart();
                resetSim();
            }
        }

        // --- Moth Class ---
        class Moth {
            constructor(type) {
                this.type = type; // 'light' or 'dark'
                this.x = Math.random() * 80 + 10; // Percent
                this.y = Math.random() * 80 + 10;
                this.id = Math.random().toString(36).substr(2, 9);
                this.element = this.create();
            }

            create() {
                const el = document.createElement('div');
                el.className = 'moth';
                el.style.left = this.x + '%';
                el.style.top = this.y + '%';
                el.style.backgroundColor = this.type === 'light' ? LIGHT_MOTH : DARK_MOTH;
                el.style.borderRadius = "20% 80% 20% 80% / 20% 20% 80% 80%"; // Organic wing shape
                el.style.transform = `rotate(${Math.random() * 360}deg)`;
                el.onclick = () => this.die();
                document.getElementById('simulation-area').appendChild(el);
                return el;
            }

            die() {
                this.element.style.opacity = '0';
                setTimeout(() => this.element.remove(), 300);
                moths = moths.filter(m => m.id !== this.id);
                updateStats();
            }
        }

        // --- Core Simulation Logic ---
        function resetSim() {
            moths.forEach(m => m.element.remove());
            moths = [];
            for(let i=0; i<20; i++) moths.push(new Moth('light'));
            for(let i=0; i<20; i++) moths.push(new Moth('dark'));
            updateStats();
            if(chart) {
                chart.data.labels = [];
                chart.data.datasets[0].data = [];
                chart.data.datasets[1].data = [];
                chart.update();
            }
        }

        function updateStats() {
            const light = moths.filter(m => m.type === 'light').length;
            const dark = moths.filter(m => m.type === 'dark').length;
            document.getElementById('stat-light').innerText = light;
            document.getElementById('stat-dark').innerText = dark;
        }

        // Predation Logic
        function simulatePredation() {
            if (moths.length === 0) return;

            // Probability of being eaten is higher for moths with high contrast to background
            // Background color is interpolated between LIGHT_BARK and DARK_BARK based on pollution
            const barkL = (100 - pollution); // % lightness of bark
            
            moths.forEach(m => {
                let visibility;
                if (m.type === 'light') {
                    // Light moths visible if bark is dark (pollution high)
                    visibility = pollution / 100;
                } else {
                    // Dark moths visible if bark is light (pollution low)
                    visibility = (100 - pollution) / 100;
                }

                // Selective Pressure: Check for death
                // Base chance + visibility factor
                if (Math.random() < visibility * 0.01) {
                    m.die();
                }
            });
        }

        function simulateReproduction() {
            // Every X frames, surviving moths reproduce
            if (moths.length < 60) {
                const survivors = [...moths];
                if (survivors.length > 0) {
                    const parent = survivors[Math.floor(Math.random() * survivors.length)];
                    moths.push(new Moth(parent.type));
                    updateStats();
                }
            }
        }

        // --- Animation Loop ---
        function loop() {
            if (currentView === 'lab') {
                frames++;
                
                // Pollution Logic
                pollution = parseInt(document.getElementById('slider-pollution').value);
                document.getElementById('lbl-pollution').innerText = pollution + "%";
                
                // Interpolate Bark Color
                // Light: #cbd5e1 (203, 213, 225)
                // Dark: #0f172a (15, 23, 42)
                const r = 203 - (pollution * 1.88);
                const g = 213 - (pollution * 1.9);
                const b = 225 - (pollution * 1.83);
                document.getElementById('forest-bg').style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

                if (document.getElementById('check-auto').checked) {
                    simulatePredation();
                }

                if (frames % 30 === 0) simulateReproduction();
                
                if (frames % 60 === 0) updateChart();
            }
            requestAnimationFrame(loop);
        }

        // --- Chart ---
        function initChart() {
            const ctx = document.getElementById('pop-chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'Light', data: [], borderColor: '#f8fafc', borderWidth: 2, pointRadius: 0, fill: false, tension: 0.4 },
                        { label: 'Dark', data: [], borderColor: '#475569', borderWidth: 2, pointRadius: 0, fill: false, tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { 
                            beginAtZero: true, 
                            max: 80,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { display: false }
                        }
                    }
                }
            });
        }

        function updateChart() {
            const light = moths.filter(m => m.type === 'light').length;
            const dark = moths.filter(m => m.type === 'dark').length;
            
            chart.data.labels.push("");
            chart.data.datasets[0].data.push(light);
            chart.data.datasets[1].data.push(dark);
            
            if (chart.data.labels.length > 50) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
                chart.data.datasets[1].data.shift();
            }
            chart.update();
        }

        // Start
        loop();
    </script>
</body>
</html>
