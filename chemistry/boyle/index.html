<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boyle's J-Tube Lab - EcrioniX Labs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        /* Watermark */
        .watermark {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900;
            color: rgba(99, 102, 241, 0.03);
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* Apparatus Components */
        .glass-tube { fill: none; stroke: rgba(255, 255, 255, 0.15); stroke-width: 24; stroke-linecap: round; }
        .tube-inner { fill: none; stroke: #020617; stroke-width: 20; stroke-linecap: round; }
        .mercury { fill: none; stroke: #94a3b8; stroke-width: 20; stroke-linecap: round; transition: all 0.2s ease-out; }
        .air-pocket { fill: #3b82f6; opacity: 0.15; transition: height 0.2s ease-out; }

        input[type=range] { accent-color: #6366f1; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <div class="watermark">EcrioniX Physics</div>

    <!-- Header -->
    <nav class="border-b border-slate-800 bg-slate-900/80 px-6 py-4 flex justify-between items-center z-50">
        <div>
            <h1 class="text-2xl font-bold text-indigo-400 tech-font uppercase tracking-wider">Boyle's <span class="text-white">J-Tube</span></h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Thermodynamics Lab: $P \cdot V = K$</p>
        </div>
        <div class="flex gap-4 items-center">
            <button onclick="resetLab()" class="bg-red-900/20 hover:bg-red-900/40 text-red-400 border border-red-900/50 px-4 py-2 rounded-lg text-xs font-bold transition">RESET DATA</button>
            <button onclick="window.history.back()" class="group flex items-center text-slate-400 hover:text-white transition bg-slate-800/80 px-4 py-2 rounded-lg border border-slate-700 hover:border-indigo-500">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                <span class="text-xs font-bold uppercase">Exit Lab</span>
            </button>
        </div>
    </nav>

    <div class="flex-grow flex p-6 gap-6 z-10 overflow-hidden">
        
        <!-- Left: Telemetry & Log -->
        <div class="w-80 flex flex-col gap-4">
            
            <!-- Digital Readouts -->
            <div class="glass-panel p-6">
                <h2 class="text-indigo-400 font-bold mb-4 uppercase text-[10px] tracking-widest text-center">Live Telemetry</h2>
                <div class="space-y-4">
                    <div class="bg-black/40 p-3 rounded-lg border border-slate-800">
                        <div class="text-[10px] text-slate-500 uppercase mb-1">Total Pressure (P)</div>
                        <div id="readout-p" class="text-xl font-bold text-white mono-font">760.0 <span class="text-xs text-slate-500">mmHg</span></div>
                    </div>
                    <div class="bg-black/40 p-3 rounded-lg border border-slate-800">
                        <div class="text-[10px] text-slate-500 uppercase mb-1">Trapped Volume (V)</div>
                        <div id="readout-v" class="text-xl font-bold text-emerald-400 mono-font">100.0 <span class="text-xs text-slate-500">cm続</span></div>
                    </div>
                    <div class="bg-black/40 p-3 rounded-lg border border-slate-800">
                        <div class="text-[10px] text-slate-500 uppercase mb-1">P &times; V Constant (k)</div>
                        <div id="readout-k" class="text-xl font-bold text-indigo-300 mono-font">76000</div>
                    </div>
                </div>
            </div>

            <!-- Lab Journal -->
            <div class="glass-panel p-4 flex-grow flex flex-col overflow-hidden">
                <h2 class="text-slate-500 font-bold mb-2 uppercase text-[10px] tracking-widest">Lab Journal</h2>
                <div class="flex-grow overflow-y-auto bg-black/20 rounded border border-slate-800">
                    <table class="w-full text-[10px] text-left">
                        <thead class="bg-slate-800 text-slate-400 sticky top-0">
                            <tr>
                                <th class="p-2">h (mm)</th>
                                <th class="p-2">P (Total)</th>
                                <th class="p-2">V (Vol)</th>
                                <th class="p-2">P&times;V</th>
                            </tr>
                        </thead>
                        <tbody id="data-table" class="text-slate-300 divide-y divide-slate-800">
                            <!-- Data entries -->
                        </tbody>
                    </table>
                </div>
                <button onclick="logData()" class="mt-4 w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-lg shadow-lg transition transform active:scale-95 text-xs">
                    LOG OBSERVATION
                </button>
            </div>
        </div>

        <!-- Center: Apparatus Visualizer -->
        <div class="flex-grow glass-panel relative flex items-center justify-center overflow-hidden">
            <div class="absolute top-6 text-[10px] text-slate-600 font-bold uppercase tracking-widest bg-slate-900/50 px-4 py-1 rounded-full border border-slate-800">
                Sealed End (Left) | Atmospheric Pressure (Right)
            </div>
            
            <svg id="tube-svg" width="400" height="600" viewBox="0 0 400 600" class="drop-shadow-2xl">
                <!-- Ruler -->
                <g transform="translate(350, 50)">
                    <line x1="0" y1="0" x2="0" y2="500" stroke="#1e293b" stroke-width="2" />
                    <script>
                        for(let i=0; i<=500; i+=10) {
                            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                            line.setAttribute("x1", i % 50 === 0 ? -12 : -6);
                            line.setAttribute("y1", i);
                            line.setAttribute("x2", 0);
                            line.setAttribute("y2", i);
                            line.setAttribute("stroke", "#334155");
                            document.currentScript.parentElement.appendChild(line);
                        }
                    </script>
                </g>

                <!-- Apparatus Backing -->
                <path d="M120,100 L120,450 Q120,520 180,520 Q240,520 240,450 L240,50" class="glass-tube" />
                <path d="M120,100 L120,450 Q120,520 180,520 Q240,520 240,450 L240,50" class="tube-inner" />

                <!-- Air Pocket (Trapped Gas) -->
                <rect id="air-pocket" x="110" y="100" width="20" height="150" class="air-pocket" />
                
                <!-- Mercury Fill (Dynamic) -->
                <path id="mercury-path" d="" class="mercury" />

                <!-- Indicator Labels -->
                <g id="h-indicator" opacity="0">
                    <line id="h-line-L" x1="130" y1="250" x2="280" y2="250" stroke="#3b82f6" stroke-dasharray="4" stroke-width="1" />
                    <line id="h-line-R" x1="230" y1="150" x2="280" y2="150" stroke="#3b82f6" stroke-dasharray="4" stroke-width="1" />
                    <path id="h-arrow" d="M280,250 L280,150" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowhead)" />
                    <text x="290" y="200" fill="#3b82f6" font-size="12" font-weight="bold" id="txt-h">h</text>
                </g>

                <text x="110" y="80" fill="#94a3b8" font-size="10" text-anchor="middle">VACUUM SEAL</text>
                <text x="240" y="30" fill="#94a3b8" font-size="10" text-anchor="middle">OPEN TO AIR</text>
            </svg>
        </div>

        <!-- Right: Control & Graph -->
        <div class="w-96 flex flex-col gap-4">
            <!-- Controls -->
            <div class="glass-panel p-6">
                <h2 class="text-indigo-400 font-bold mb-6 uppercase text-[10px] tracking-widest">Apparatus Control</h2>
                <div class="space-y-6">
                    <div>
                        <div class="flex justify-between text-xs mb-2">
                            <span class="text-slate-400">Pour Mercury (cm続)</span>
                            <span id="lbl-hg" class="text-white font-bold">0</span>
                        </div>
                        <input type="range" id="slider-hg" min="0" max="600" step="10" value="0" class="w-full">
                        <p class="text-[9px] text-slate-500 mt-2 italic leading-relaxed">
                            Adding mercury to the open end increases head pressure (h), compressing the trapped air volume (V).
                        </p>
                    </div>
                </div>
            </div>

            <!-- Graph -->
            <div class="glass-panel p-4 flex-grow flex flex-col">
                <h2 class="text-indigo-400 font-bold mb-4 uppercase text-[10px] tracking-widest text-center">Boyle's Curve ($P$ vs $V$)</h2>
                <div class="flex-grow relative bg-black/20 rounded">
                    <canvas id="boyleChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- Chart and Logic Script -->
    <script>
        // --- State ---
        let pAtm = 760; // Standard atmospheric pressure (mmHg)
        let vInitial = 100; // Original cm3 of air
        let k = pAtm * vInitial; // Constant
        let currentHgAdded = 0;
        let chart;

        // --- DOM ---
        const sliderHg = document.getElementById('slider-hg');
        const lblHg = document.getElementById('lbl-hg');
        const readoutP = document.getElementById('readout-p');
        const readoutV = document.getElementById('readout-v');
        const readoutK = document.getElementById('readout-k');
        const mercuryPath = document.getElementById('mercury-path');
        const airPocket = document.getElementById('air-pocket');
        const hIndicator = document.getElementById('h-indicator');
        const txtH = document.getElementById('txt-h');
        const hLineL = document.getElementById('h-line-L');
        const hLineR = document.getElementById('h-line-R');
        const dataTable = document.getElementById('data-table');

        // --- Initialization ---
        function initChart() {
            const ctx = document.getElementById('boyleChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Data Points',
                        data: [],
                        backgroundColor: '#6366f1',
                        pointRadius: 5
                    }, {
                        label: 'Theoretical Curve',
                        data: generateTheoreticalData(),
                        type: 'line',
                        borderColor: 'rgba(99, 102, 241, 0.2)',
                        borderWidth: 1,
                        pointRadius: 0,
                        fill: false,
                        showLine: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Volume (V) [cm続]', color: '#94a3b8' }, grid: { color: '#1e293b' }, min: 0, max: 120 },
                        y: { title: { display: true, text: 'Pressure (P) [mmHg]', color: '#94a3b8' }, grid: { color: '#1e293b' }, min: 500, max: 1500 }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function generateTheoreticalData() {
            let data = [];
            for (let v = 20; v <= 110; v += 2) {
                data.push({ x: v, y: k / v });
            }
            return data;
        }

        // --- Core Simulation Logic ---
        function updateSimulation() {
            currentHgAdded = parseInt(sliderHg.value);
            lblHg.innerText = currentHgAdded;

            /* Physics Logic:
               We assume J-Tube cross section = 1 cm2.
               Adding mercury h_added increases the head.
               But the mercury level in the sealed side drops as volume is compressed.
               
               P_total = P_atm + h
               h = (Total Hg Height in Right Arm) - (Total Hg Height in Left Arm)
               
               This is a bit more complex in real J-tubes. 
               Let's simplify for the visual:
               1. Base Hg level in left arm is determined by V = k / P_total.
               2. h is derived from the amount of Hg added.
            */

            // Calculate V using an iterative approach or simplified model
            // h approx increases as hg_added / 2
            let h = currentHgAdded * 1.2; // Scaling factor for visual dramatic effect
            let pTotal = pAtm + h;
            let vCurrent = k / pTotal;

            // Visual Coordinate calculation (SVG space)
            // Left arm top at 100. Tube bottom at 520.
            // When V=100, air height is 150px (y=100 to y=250).
            const airHeightPx = vCurrent * 1.5; 
            const leftHgY = 100 + airHeightPx; 
            
            // h is the height difference between right and left mercury levels
            const hVisual = h / 2; // Scale h for the SVG height
            const rightHgY = leftHgY - hVisual;

            // Update SVG
            // Update the air pocket rectangle
            airPocket.setAttribute('height', airHeightPx);

            // Construct Mercury Path
            // Starts at Left Surface -> Down -> Curve -> Up -> Right Surface
            const d = `M120,${leftHgY} L120,450 Q120,520 180,520 Q240,520 240,450 L240,${Math.max(50, rightHgY)}`;
            mercuryPath.setAttribute('d', d);

            // Update Telemetry
            readoutP.innerHTML = `${pTotal.toFixed(1)} <span class="text-xs text-slate-500">mmHg</span>`;
            readoutV.innerHTML = `${vCurrent.toFixed(1)} <span class="text-xs text-slate-500">cm続</span>`;
            readoutK.innerText = (pTotal * vCurrent).toFixed(0);

            // Update Indicators
            if (h > 10) {
                hIndicator.setAttribute('opacity', 1);
                hLineL.setAttribute('y1', leftHgY); hLineL.setAttribute('y2', leftHgY);
                hLineR.setAttribute('y1', rightHgY); hLineR.setAttribute('y2', rightHgY);
                document.getElementById('h-arrow').setAttribute('d', `M280,${leftHgY} L280,${rightHgY}`);
                txtH.setAttribute('y', (leftHgY + rightHgY) / 2 + 5);
            } else {
                hIndicator.setAttribute('opacity', 0);
            }
        }

        // --- Interactions ---
        function logData() {
            const h = (parseFloat(readoutP.innerText) - pAtm).toFixed(0);
            const p = parseFloat(readoutP.innerText).toFixed(1);
            const v = parseFloat(readoutV.innerText).toFixed(1);
            const prod = (p * v).toFixed(0);

            // Update Table
            const row = document.createElement('tr');
            row.innerHTML = `<td class="p-2">${h}</td><td class="p-2 text-white">${p}</td><td class="p-2 text-emerald-400">${v}</td><td class="p-2">${prod}</td>`;
            dataTable.prepend(row);

            // Update Graph
            chart.data.datasets[0].data.push({ x: v, y: p });
            chart.update();
        }

        function resetLab() {
            sliderHg.value = 0;
            dataTable.innerHTML = '';
            chart.data.datasets[0].data = [];
            chart.update();
            updateSimulation();
        }

        // --- Init ---
        sliderHg.addEventListener('input', updateSimulation);
        initChart();
        updateSimulation();

    </script>
</body>
</html>
