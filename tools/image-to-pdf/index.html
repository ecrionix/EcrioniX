<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcrioniX - Image to PDF Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; }
        .tech-font { font-family: 'Orbitron', sans-serif; }

        /* Background Watermark */
        .watermark {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900; color: rgba(99, 102, 241, 0.03);
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
        }

        /* Drop Zone Styles */
        .drop-zone {
            @apply w-full h-48 border-2 border-dashed border-slate-700 rounded-2xl flex flex-col items-center justify-center transition-all cursor-pointer bg-slate-900/30;
        }
        .drop-zone.dragover { @apply border-indigo-500 bg-indigo-500/10 scale-[0.99]; }
        
        /* Grid Layout for Sortable Thumbnails */
        #image-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }
        .image-card {
            @apply relative aspect-[3/4] bg-slate-800 rounded-lg border border-slate-700 overflow-hidden cursor-move shadow-lg transition-transform;
        }
        .image-card:hover { transform: scale(1.02); }
        .image-card img { @apply w-full h-full object-cover; }
        .image-card .remove-btn {
            @apply absolute top-1 right-1 w-6 h-6 bg-red-500/80 rounded-full flex items-center justify-center text-white opacity-0 transition-opacity;
        }
        .image-card:hover .remove-btn { @apply opacity-100; }
        .image-index {
            @apply absolute bottom-1 left-1 bg-black/60 px-2 py-0.5 rounded text-[10px] font-bold text-white;
        }

        /* Loading States */
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .sortable-ghost { opacity: 0.4; border: 2px dashed #6366f1; }
    </style>
</head>
<body class="min-h-screen flex flex-col relative">

    <div class="watermark">EcrioniX Lab</div>

    <!-- Header Navigation -->
    <nav class="border-b border-slate-800 bg-slate-900/80 px-6 py-4 flex justify-between items-center z-50 sticky top-0 backdrop-blur-md">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-black tech-font text-xl shadow-[0_0_15px_rgba(99,102,241,0.4)]">E</div>
            <div>
                <h1 class="text-xl font-bold text-white uppercase tracking-tight">ECRIONIX <span class="text-indigo-400">IMG2PDF</span></h1>
                <p class="text-[9px] text-slate-500 uppercase font-black tracking-widest mt-1">High-Speed Local Conversion</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <button onclick="resetAll()" class="text-[10px] font-bold text-slate-500 hover:text-red-400 transition uppercase tracking-widest">Clear Workspace</button>
            <a href="../" class="text-xs font-bold text-slate-400 hover:text-white transition uppercase tracking-widest border border-slate-700 px-4 py-2 rounded-lg">Back to Hub</a>
        </div>
    </nav>

    <!-- Main Workspace -->
    <main class="flex-grow p-4 md:p-8 relative z-10 flex flex-col items-center">
        
        <div class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <!-- Left: Configuration & Input -->
            <div class="lg:col-span-4 space-y-6">
                
                <div class="glass-panel p-6 shadow-xl border-indigo-500/10">
                    <h2 class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-6">1. Import Assets</h2>
                    
                    <input type="file" id="img-input" class="hidden" multiple accept="image/jpeg,image/png,image/webp">
                    <label for="img-input" class="drop-zone" id="drop-zone">
                        <svg class="w-10 h-10 text-slate-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <span class="text-xs font-bold text-slate-300">Drag files here or <span class="text-indigo-400 underline">browse</span></span>
                    </label>
                    <p class="text-[9px] text-center text-slate-500 mt-4 uppercase">Secure: Files processed in-browser</p>
                </div>

                <div class="glass-panel p-6">
                    <h2 class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-6">2. Layout Config</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Target Page Size</label>
                            <select id="page-size" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-indigo-500">
                                <option value="A4">A4 (Standard)</option>
                                <option value="fit">Match Original Size</option>
                            </select>
                        </div>
                        
                        <div id="orientation-wrap">
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Orientation</label>
                            <div class="flex gap-2">
                                <button onclick="setOrientation('portrait')" id="btn-portrait" class="flex-1 py-2 bg-indigo-600 text-white rounded text-[10px] font-bold border border-indigo-500 shadow">PORTRAIT</button>
                                <button onclick="setOrientation('landscape')" id="btn-landscape" class="flex-1 py-2 bg-slate-800 text-slate-400 rounded text-[10px] font-bold border border-slate-700">LANDSCAPE</button>
                            </div>
                        </div>

                        <div>
                            <label class="text-[10px] font-black text-slate-500 uppercase block mb-2">Fit Strategy</label>
                            <select id="img-scale" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-indigo-500">
                                <option value="fit">Contain (Preserve Ratio)</option>
                                <option value="fill">Cover (Edge-to-Edge)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Execution Button -->
                <button onclick="generatePDF()" id="btn-convert" class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-2xl shadow-lg transition transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3">
                    <span id="btn-text">CONVERT TO PDF</span>
                    <div id="spinner" class="loading-spinner hidden"></div>
                </button>
                <p id="status-msg" class="text-center text-[10px] text-slate-500 font-bold uppercase hidden"></p>

            </div>

            <!-- Right: Page Reorder Grid -->
            <div class="lg:col-span-8 flex flex-col gap-4 min-h-[500px]">
                <div class="glass-panel p-6 flex-grow flex flex-col bg-slate-900/30 border-slate-800">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Organize Pages</h2>
                        <span id="file-count" class="text-[10px] font-mono text-indigo-400 bg-indigo-500/10 px-2 py-0.5 rounded border border-indigo-500/20">0 IMAGES</span>
                    </div>

                    <div id="image-list" class="flex-grow">
                        <!-- Sorted Thumbnails -->
                    </div>

                    <div id="empty-state" class="flex-grow flex flex-col items-center justify-center py-20 text-slate-600">
                        <svg class="w-16 h-16 mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <p class="text-sm font-bold uppercase tracking-widest opacity-40">Ready for upload</p>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-800 bg-slate-950/50 py-8 text-center relative z-10">
        <p class="text-slate-600 text-[10px] font-black tracking-[0.2em] uppercase mb-1">&copy; 2026 EcrioniX Labs</p>
        <p class="text-slate-500 text-[10px]">Processing by <span class="text-indigo-500 font-bold">EcrioniX Local-Sync Engine</span>. Document privacy preserved.</p>
    </footer>

    <script>
        // --- Core Engine ---
        let uploadedImages = []; // Array of { id, file, dataUrl, name }
        let orientation = 'portrait';
        const pdfLib = window.PDFLib;

        const imgInput = document.getElementById('img-input');
        const dropZone = document.getElementById('drop-zone');
        const imageList = document.getElementById('image-list');
        const emptyState = document.getElementById('empty-state');
        const fileCount = document.getElementById('file-count');
        const btnConvert = document.getElementById('btn-convert');
        const spinner = document.getElementById('spinner');
        const statusMsg = document.getElementById('status-msg');

        // Init Sortable Grid
        const sortable = new Sortable(imageList, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: () => {
                const newOrder = Array.from(imageList.children).map(el => el.dataset.id);
                uploadedImages.sort((a, b) => newOrder.indexOf(a.id.toString()) - newOrder.indexOf(b.id.toString()));
                renderIndexes();
            }
        });

        // File Selection Logic
        imgInput.addEventListener('change', e => handleFiles(e.target.files));
        dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', e => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        function handleFiles(files) {
            const added = Array.from(files).filter(f => f.type.startsWith('image/'));
            
            added.forEach(file => {
                const reader = new FileReader();
                const id = Date.now() + Math.random();
                reader.onload = (e) => {
                    uploadedImages.push({ id, file, dataUrl: e.target.result, name: file.name });
                    addThumbnailToGrid(id, e.target.result);
                    updateUI();
                };
                reader.readAsDataURL(file);
            });
        }

        function addThumbnailToGrid(id, dataUrl) {
            const div = document.createElement('div');
            div.className = 'image-card';
            div.dataset.id = id;
            div.innerHTML = `
                <img src="${dataUrl}">
                <div class="image-index"></div>
                <button onclick="removeImage('${id}')" class="remove-btn">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            `;
            imageList.appendChild(div);
            renderIndexes();
        }

        function removeImage(id) {
            uploadedImages = uploadedImages.filter(img => img.id.toString() !== id.toString());
            const el = imageList.querySelector(`[data-id="${id}"]`);
            if (el) el.remove();
            updateUI();
            renderIndexes();
        }

        function renderIndexes() {
            Array.from(imageList.children).forEach((el, i) => {
                el.querySelector('.image-index').innerText = `P. ${i + 1}`;
            });
        }

        function setOrientation(o) {
            orientation = o;
            document.getElementById('btn-portrait').className = o === 'portrait' ? 'flex-1 py-2 bg-indigo-600 text-white rounded text-[10px] font-bold border border-indigo-500 shadow' : 'flex-1 py-2 bg-slate-800 text-slate-400 rounded text-[10px] font-bold border border-slate-700';
            document.getElementById('btn-landscape').className = o === 'landscape' ? 'flex-1 py-2 bg-indigo-600 text-white rounded text-[10px] font-bold border border-indigo-500 shadow' : 'flex-1 py-2 bg-slate-800 text-slate-400 rounded text-[10px] font-bold border border-slate-700';
        }

        function updateUI() {
            const count = uploadedImages.length;
            fileCount.innerText = `${count} IMAGE${count === 1 ? '' : 'S'}`;
            emptyState.classList.toggle('hidden', count > 0);
            btnConvert.disabled = count === 0;
            const sizeMode = document.getElementById('page-size').value;
            document.getElementById('orientation-wrap').classList.toggle('hidden', sizeMode === 'fit');
        }

        document.getElementById('page-size').addEventListener('change', updateUI);

        function resetAll() {
            uploadedImages = [];
            imageList.innerHTML = '';
            updateUI();
        }

        async function generatePDF() {
            if (uploadedImages.length === 0) return;

            toggleLoading(true);
            updateStatus("Generating EcrioniX PDF...");

            try {
                const pdfDoc = await pdfLib.PDFDocument.create();
                
                // Add EcrioniX Metadata
                pdfDoc.setTitle('EcrioniX Converted Document');
                pdfDoc.setAuthor('EcrioniX Labs');
                pdfDoc.setSubject('Image to PDF Conversion');
                pdfDoc.setProducer('EcrioniX PDF Engine');

                const scaleMode = document.getElementById('img-scale').value;
                const sizeMode = document.getElementById('page-size').value;

                for (const item of uploadedImages) {
                    const imgBytes = await fetch(item.dataUrl).then(res => res.arrayBuffer());
                    let embeddedImg;
                    
                    if (item.file.type === 'image/jpeg') {
                        embeddedImg = await pdfDoc.embedJpg(imgBytes);
                    } else if (item.file.type === 'image/png') {
                        embeddedImg = await pdfDoc.embedPng(imgBytes);
                    } else {
                        embeddedImg = await convertToPdfImage(pdfDoc, item.dataUrl);
                    }

                    const { width: imgW, height: imgH } = embeddedImg.size();
                    let pageWidth, pageHeight;

                    if (sizeMode === 'fit') {
                        pageWidth = imgW;
                        pageHeight = imgH;
                    } else {
                        pageWidth = orientation === 'portrait' ? 595.28 : 841.89;
                        pageHeight = orientation === 'portrait' ? 841.89 : 595.28;
                    }

                    const page = pdfDoc.addPage([pageWidth, pageHeight]);
                    let drawWidth, drawHeight, x = 0, y = 0;

                    if (sizeMode === 'fit') {
                        drawWidth = pageWidth;
                        drawHeight = pageHeight;
                    } else {
                        const ratio = imgW / imgH;
                        const pageRatio = pageWidth / pageHeight;

                        if (scaleMode === 'fit') {
                            if (ratio > pageRatio) {
                                drawWidth = pageWidth;
                                drawHeight = pageWidth / ratio;
                            } else {
                                drawHeight = pageHeight;
                                drawWidth = pageHeight * ratio;
                            }
                        } else {
                            if (ratio > pageRatio) {
                                drawHeight = pageHeight;
                                drawWidth = pageHeight * ratio;
                            } else {
                                drawWidth = pageWidth;
                                drawHeight = pageWidth / ratio;
                            }
                        }
                        x = (pageWidth - drawWidth) / 2;
                        y = (pageHeight - drawHeight) / 2;
                    }

                    page.drawImage(embeddedImg, { x, y, width: drawWidth, height: drawHeight });
                }

                const pdfBytes = await pdfDoc.save();
                download(pdfBytes, "ecrionix_converted.pdf");
                updateStatus("EcrioniX PDF Complete!", "text-green-400");
                setTimeout(() => statusMsg.classList.add('hidden'), 3000);
            } catch (err) {
                console.error(err);
                updateStatus("Error: " + err.message, "text-red-400");
            } finally {
                toggleLoading(false);
            }
        }

        async function convertToPdfImage(doc, dataUrl) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = async () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width; canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    const pngData = canvas.toDataURL('image/png').split(',')[1];
                    const pngBytes = Uint8Array.from(atob(pngData), c => c.charCodeAt(0));
                    resolve(await doc.embedPng(pngBytes));
                };
                img.onerror = reject;
                img.src = dataUrl;
            });
        }

        function toggleLoading(active) {
            spinner.classList.toggle('hidden', !active);
            btnConvert.disabled = active;
        }

        function updateStatus(msg, cls = "text-slate-500") {
            statusMsg.innerText = msg;
            statusMsg.className = `text-center text-[10px] font-bold uppercase mt-4 ${cls}`;
            statusMsg.classList.remove('hidden');
        }

        function download(bytes, filename) {
            const blob = new Blob([bytes], { type: "application/pdf" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        updateUI();
    </script>
</body>
</html>
