<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocket Landing Simulator - EcrioniX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; overflow: hidden; touch-action: none; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        
        /* Watermark */
        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem;
            font-weight: 900;
            color: rgba(99, 102, 241, 0.05);
            pointer-events: none;
            user-select: none;
            white-space: nowrap;
            z-index: 0;
        }

        #game-canvas {
            background: linear-gradient(to bottom, #020617 0%, #1e3a8a 80%, #0c4a6e 100%);
            width: 100%;
            height: 100%;
        }

        /* HUD */
        .hud-panel {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            backdrop-filter: blur(4px);
        }
        
        /* Controls */
        .btn-control {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.1s;
        }
        .btn-control:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }
        .btn-thrust:active { background: #f59e0b; border-color: #f59e0b; }

    </style>
</head>
<body class="relative h-screen w-screen">

    <div class="watermark">EcrioniX Space</div>

    <canvas id="game-canvas"></canvas>

    <!-- HUD -->
    <div class="absolute top-4 left-4 p-4 rounded-xl hud-panel w-64">
        <h1 class="text-xl font-bold text-white tech-font mb-2">TELEMETRY</h1>
        <div class="grid grid-cols-2 gap-2 text-xs font-mono">
            <div class="text-slate-400">ALTITUDE</div>
            <div id="hud-alt" class="text-right text-white">0 m</div>
            
            <div class="text-slate-400">VELOCITY Y</div>
            <div id="hud-vy" class="text-right text-white">0 m/s</div>
            
            <div class="text-slate-400">VELOCITY X</div>
            <div id="hud-vx" class="text-right text-white">0 m/s</div>
            
            <div class="text-slate-400">FUEL</div>
            <div class="text-right">
                <div class="w-full bg-slate-700 h-2 rounded-full mt-1">
                    <div id="hud-fuel" class="bg-green-500 h-2 rounded-full" style="width: 100%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Message -->
    <div id="status-msg" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center hidden">
        <h2 id="status-title" class="text-5xl font-bold text-white tech-font mb-2 drop-shadow-lg">LANDED</h2>
        <p id="status-sub" class="text-xl text-slate-200">Perfect Touchdown!</p>
        <button onclick="resetGame()" class="mt-6 px-8 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg font-bold shadow-lg transition">RETRY MISSION</button>
    </div>

    <!-- Mobile Controls -->
    <div class="absolute bottom-6 left-6 right-6 flex justify-between items-end md:hidden">
        <div class="flex gap-4">
            <button id="btn-left" class="btn-control w-16 h-16 rounded-full text-2xl">←</button>
            <button id="btn-right" class="btn-control w-16 h-16 rounded-full text-2xl">→</button>
        </div>
        <button id="btn-thrust" class="btn-control w-20 h-20 rounded-full text-xl font-bold border-2 border-yellow-500/50 text-yellow-400 btn-thrust">
            BURN
        </button>
    </div>

    <!-- Instructions (Desktop) -->
    <div class="absolute bottom-6 right-6 text-right hidden md:block text-slate-400 text-xs">
        <p><strong>UP ARROW</strong> - Main Engine</p>
        <p><strong>LEFT / RIGHT</strong> - RCS Thrusters</p>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        // --- Game State ---
        let width, height;
        let gameState = 'PLAYING'; // PLAYING, LANDED, CRASHED
        
        // Physics Constants
        const GRAVITY = 0.05;
        const THRUST_POWER = 0.15;
        const ROTATION_SPEED = 0.02;
        const RCS_POWER = 0.02;
        const DRAG = 0.99;

        // Rocket Object
        const rocket = {
            x: 0, y: 0,
            vx: 0, vy: 0,
            angle: 0,
            width: 20, height: 100,
            fuel: 100,
            legsDeployed: false,
            thrusting: false,
            rotatingLeft: false,
            rotatingRight: false
        };

        // Drone Ship
        const ship = {
            x: 0, y: 0,
            width: 200, height: 20
        };

        // Particles (Smoke/Fire)
        let particles = [];

        // --- Init ---
        function init() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            // Reset Rocket
            rocket.x = width / 2;
            rocket.y = 100;
            rocket.vx = (Math.random() - 0.5) * 4; // Random initial drift
            rocket.vy = 2; // Initial drop speed
            rocket.angle = (Math.random() - 0.5) * 0.5; // Random initial tilt
            rocket.fuel = 100;
            rocket.legsDeployed = false;

            // Position Ship
            ship.x = width / 2 - ship.width / 2;
            ship.y = height - 50;

            gameState = 'PLAYING';
            particles = [];
            
            document.getElementById('status-msg').classList.add('hidden');
        }

        function resetGame() {
            init();
        }

        // --- Inputs ---
        const keys = {};

        window.addEventListener('keydown', (e) => {
            if (gameState !== 'PLAYING') return;
            if (e.code === 'ArrowUp' || e.code === 'Space') rocket.thrusting = true;
            if (e.code === 'ArrowLeft') rocket.rotatingLeft = true;
            if (e.code === 'ArrowRight') rocket.rotatingRight = true;
        });

        window.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowUp' || e.code === 'Space') rocket.thrusting = false;
            if (e.code === 'ArrowLeft') rocket.rotatingLeft = false;
            if (e.code === 'ArrowRight') rocket.rotatingRight = false;
        });

        // Touch/Mouse for Mobile
        const btnThrust = document.getElementById('btn-thrust');
        const btnLeft = document.getElementById('btn-left');
        const btnRight = document.getElementById('btn-right');

        const addTouch = (el, prop) => {
            el.addEventListener('touchstart', (e) => { e.preventDefault(); rocket[prop] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); rocket[prop] = false; });
            el.addEventListener('mousedown', () => { rocket[prop] = true; });
            el.addEventListener('mouseup', () => { rocket[prop] = false; });
        };
        addTouch(btnThrust, 'thrusting');
        addTouch(btnLeft, 'rotatingLeft');
        addTouch(btnRight, 'rotatingRight');

        // --- Physics Engine ---
        function update() {
            if (gameState !== 'PLAYING') return;

            // Gravity
            rocket.vy += GRAVITY;

            // Thrust
            if (rocket.thrusting && rocket.fuel > 0) {
                rocket.fuel -= 0.3;
                // Thrust vector based on angle
                // If angle is 0 (upright), thrust pushes UP (negative Y)
                // Math.sin(angle) gives X component, Math.cos(angle) gives Y
                const ax = Math.sin(rocket.angle) * THRUST_POWER;
                const ay = Math.cos(rocket.angle) * THRUST_POWER;
                
                rocket.vx += ax; // Pushes opposite to tilt? No, engine at bottom pushes UP-Left if tilted Right.
                // Wait, if rocket tilts right (positive angle), bottom points left. Thrust pushes up-right.
                // Correct: Thrust adds vector in direction of nose.
                // Actually easier: Rocket thrust pushes "Forward" relative to its nose? No, main engine pushes "Up" relative to rocket body.
                
                // Let's assume Angle 0 is UP.
                rocket.vx += Math.sin(rocket.angle) * THRUST_POWER; 
                rocket.vy -= Math.cos(rocket.angle) * THRUST_POWER;

                // Particles
                createParticles(10, 'fire');
            }

            // RCS (Rotation)
            if (rocket.rotatingLeft) {
                rocket.angle -= ROTATION_SPEED;
                rocket.fuel -= 0.05;
                createParticles(1, 'rcs-left');
            }
            if (rocket.rotatingRight) {
                rocket.angle += ROTATION_SPEED;
                rocket.fuel -= 0.05;
                createParticles(1, 'rcs-right');
            }

            // Air Resistance
            rocket.vx *= DRAG;
            // rocket.vy *= DRAG; // Gravity overcomes drag mostly

            // Position
            rocket.x += rocket.vx;
            rocket.y += rocket.vy;

            // Deploy Legs if close
            if (rocket.y > height - 200) {
                rocket.legsDeployed = true;
            }

            // Collision Detection
            checkCollision();
            
            // Particle Updates
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if(p.life <= 0) particles.splice(i, 1);
            });
        }

        function checkCollision() {
            // Ground Level
            const groundY = ship.y;

            // Check if bottom of rocket hits ground line
            // Rocket center is x,y. Height is 100. Bottom is y + 50.
            const rocketBottom = rocket.y + 50; // Half height

            if (rocketBottom >= groundY) {
                // Check Horizontal alignment with Ship
                const hitShip = rocket.x > ship.x && rocket.x < ship.x + ship.width;
                
                // Check Speed and Angle
                const safeSpeed = Math.abs(rocket.vy) < 2.5 && Math.abs(rocket.vx) < 1.5;
                const safeAngle = Math.abs(rocket.angle) < 0.2; // ~11 degrees

                if (hitShip && safeSpeed && safeAngle) {
                    gameState = 'LANDED';
                    showStatus('TOUCHDOWN', 'The Falcon has landed.', 'text-green-500');
                    rocket.y = groundY - 50; // Snap to deck
                    rocket.vy = 0;
                    rocket.vx = 0;
                    rocket.angle = 0;
                } else {
                    gameState = 'CRASHED';
                    if (!hitShip) showStatus('SPLASHDOWN', 'You missed the drone ship.', 'text-blue-400');
                    else showStatus('RUD', 'Rapid Unscheduled Disassembly.', 'text-red-500');
                    
                    // Explosion particles
                    createParticles(100, 'explosion');
                }
            }
        }

        // --- Rendering ---
        function draw() {
            // Clear
            ctx.clearRect(0, 0, width, height);

            // 1. Draw Ocean
            ctx.fillStyle = '#0f172a'; // Deep water
            ctx.fillRect(0, height-20, width, 20);

            // 2. Draw Drone Ship
            ctx.fillStyle = '#334155';
            ctx.fillRect(ship.x, ship.y, ship.width, ship.height);
            // "X" mark
            ctx.strokeStyle = '#facc15';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(ship.x + ship.width/2 - 20, ship.y + 5);
            ctx.lineTo(ship.x + ship.width/2 + 20, ship.y + 15);
            ctx.moveTo(ship.x + ship.width/2 + 20, ship.y + 5);
            ctx.lineTo(ship.x + ship.width/2 - 20, ship.y + 15);
            ctx.stroke();

            // 3. Draw Particles
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 50;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fill();
                ctx.globalAlpha = 1;
            });

            // 4. Draw Rocket
            if (gameState !== 'CRASHED') {
                ctx.save();
                ctx.translate(rocket.x, rocket.y);
                ctx.rotate(rocket.angle);

                // Body
                ctx.fillStyle = '#e2e8f0'; // White
                ctx.fillRect(-10, -50, 20, 100);
                
                // Nose cone (Fairing?)
                ctx.beginPath();
                ctx.moveTo(-10, -50);
                ctx.lineTo(0, -70);
                ctx.lineTo(10, -50);
                ctx.fill();

                // Grid Fins (if deployed? Always visible for steering)
                ctx.fillStyle = '#1e293b';
                ctx.fillRect(-14, -40, 4, 8); // Left
                ctx.fillRect(10, -40, 4, 8);  // Right

                // Landing Legs
                if (rocket.legsDeployed) {
                    ctx.strokeStyle = '#1e293b';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    // Left Leg
                    ctx.moveTo(-10, 40);
                    ctx.lineTo(-25, 60);
                    // Right Leg
                    ctx.moveTo(10, 40);
                    ctx.lineTo(25, 60);
                    ctx.stroke();
                }

                // Engine Bell
                ctx.fillStyle = '#334155';
                ctx.beginPath();
                ctx.moveTo(-5, 50);
                ctx.lineTo(5, 50);
                ctx.lineTo(8, 55);
                ctx.lineTo(-8, 55);
                ctx.fill();

                ctx.restore();
            }

            // Update HUD
            document.getElementById('hud-alt').innerText = Math.max(0, Math.floor((ship.y - (rocket.y+50)))).toFixed(0) + " m";
            document.getElementById('hud-vy').innerText = (rocket.vy * -10).toFixed(1) + " m/s"; // Invert for "Climb rate"
            document.getElementById('hud-vx').innerText = (rocket.vx * 10).toFixed(1) + " m/s";
            
            const fuelEl = document.getElementById('hud-fuel');
            fuelEl.style.width = rocket.fuel + "%";
            if(rocket.fuel < 20) fuelEl.classList.replace('bg-green-500', 'bg-red-500');

        }

        function createParticles(count, type) {
            for(let i=0; i<count; i++) {
                let p = {
                    x: rocket.x, 
                    y: rocket.y + 50, // Engine pos
                    life: 30 + Math.random() * 20,
                    size: Math.random() * 4 + 2,
                    vx: (Math.random() - 0.5) * 2,
                    vy: 2 + Math.random() * 2, // Downward
                    color: `rgba(255, ${Math.floor(Math.random()*200)}, 0, 1)` // Orange/Yellow
                };

                // Adjust position/velocity based on rocket rotation for realism
                // (Simplified: Just emit from bottom)
                if (type === 'explosion') {
                    p.x = rocket.x;
                    p.y = rocket.y;
                    p.vx = (Math.random() - 0.5) * 10;
                    p.vy = (Math.random() - 0.5) * 10;
                    p.life = 100;
                    p.color = Math.random() > 0.5 ? '#ef4444' : '#fbbf24';
                }
                else if (type === 'rcs-left') {
                    // Puff from top right pushing left?
                    // RCS usually at top. Pushes opposite to rotation needed.
                    // If turning left (CCW), thruster on right pushes up?
                    // Visual hack: Puff near nose
                    p.y = rocket.y - 40;
                    p.x = rocket.x + 10;
                    p.vx = 2; 
                    p.vy = (Math.random() - 0.5);
                    p.color = '#fff';
                    p.size = 2;
                }
                else if (type === 'rcs-right') {
                    p.y = rocket.y - 40;
                    p.x = rocket.x - 10;
                    p.vx = -2;
                    p.vy = (Math.random() - 0.5);
                    p.color = '#fff';
                    p.size = 2;
                }

                particles.push(p);
            }
        }

        function showStatus(title, sub, colorClass) {
            document.getElementById('status-title').innerText = title;
            document.getElementById('status-title').className = `text-5xl font-bold tech-font mb-2 drop-shadow-lg ${colorClass}`;
            document.getElementById('status-sub').innerText = sub;
            document.getElementById('status-msg').classList.remove('hidden');
        }

        // --- Loop ---
        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        window.addEventListener('resize', init);
        init();
        loop();

    </script>
</body>
</html>
