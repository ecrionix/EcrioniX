<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latch vs Flip-Flop Lab - EcrioniX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        .watermark {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900; color: rgba(99, 102, 241, 0.03);
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
        }

        /* Tabs */
        .tab-btn {
            @apply px-6 py-3 font-bold text-xs transition-all duration-300 border-b-2 border-transparent text-slate-400 uppercase tracking-wider;
        }
        .tab-active {
            @apply border-indigo-500 text-white bg-indigo-500/10;
        }

        /* Circuit Components */
        .gate-body { fill: #1e293b; stroke: #94a3b8; stroke-width: 2; transition: all 0.2s; }
        .gate-active { stroke: #fbbf24; fill: #422006; filter: drop-shadow(0 0 5px #fbbf24); }
        .wire { fill: none; stroke: #475569; stroke-width: 3; transition: stroke 0.1s; stroke-linecap: round; }
        .wire-active { stroke: #fbbf24; filter: drop-shadow(0 0 4px #fbbf24); }
        .wire-clk { stroke: #ef4444; opacity: 0.8; }
        .wire-clk-high { stroke: #ef4444; filter: drop-shadow(0 0 4px #ef4444); stroke-width: 4; }

        /* Waveform */
        .wave-canvas {
            background-color: #111827;
            border: 1px solid #374151;
            border-radius: 8px;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Theory Typography */
        .prose h1 { @apply text-3xl font-bold text-white mb-6 tech-font border-b border-slate-800 pb-2; }
        .prose h2 { @apply text-xl font-bold text-indigo-400 mt-8 mb-4 uppercase tracking-wider; }
        .prose p { @apply text-slate-400 mb-4 leading-relaxed text-sm; }
        .prose strong { @apply text-white font-semibold; }
        .prose ul { @apply list-disc list-inside space-y-2 text-slate-400 mb-4 text-sm; }

        .hidden { display: none !important; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <div class="watermark">EcrioniX VLSI</div>

    <!-- Header -->
    <nav class="border-b border-slate-800 bg-slate-900/80 px-6 py-3 flex justify-between items-center z-50">
        <div>
            <h1 class="text-xl font-bold text-indigo-400 tech-font uppercase">Latch vs <span class="text-white">Flip-Flop</span></h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Sequential Logic Fundamentals</p>
        </div>
        <div class="flex bg-slate-950 p-1 rounded-xl border border-slate-800">
            <button onclick="switchView('theory')" id="btn-theory" class="tab-btn tab-active">THEORY GUIDE</button>
            <button onclick="switchView('lab')" id="btn-lab" class="tab-btn">COMPARISON LAB</button>
        </div>
        <button onclick="window.history.back()" class="group flex items-center text-slate-400 hover:text-white transition bg-slate-800/80 px-4 py-2 rounded-lg border border-slate-700 hover:border-indigo-500">
            <span class="text-xs font-bold uppercase">Exit Lab</span>
        </button>
    </nav>

    <!-- Content Area -->
    <div class="flex-grow overflow-hidden relative">
        
        <!-- VIEW 1: THEORY -->
        <div id="view-theory" class="absolute inset-0 z-10 overflow-y-auto p-8 flex justify-center">
            <div class="max-w-4xl w-full glass-panel p-10 prose">
                <h1>Understanding Sequential Elements</h1>
                <p>
                    In digital electronics, storing state information is essential. The two primary building blocks for storage are the **Latch** and the **Flip-Flop**. While they both store one bit of data, the mechanism by which they update that data—the trigger—is fundamentally different.
                </p>

                <h2>1. The Latch: Level-Sensitive</h2>
                <p>
                    A Latch is **Level-Sensitive**. This means it responds to the input data ($D$) as long as the Enable signal (or Clock) is held at a specific logic level (usually High, '1').
                </p>
                <ul>
                    <li><strong>Transparent Phase:</strong> When $CLK = 1$, the output $Q$ follows input $D$ instantly. If $D$ changes, $Q$ changes. The latch is "transparent."</li>
                    <li><strong>Latching Phase:</strong> When $CLK = 0$, the output $Q$ is frozen. It holds the last value of $D$ present just before the clock went low.</li>
                    <li><strong>Disadvantage:</strong> Since it is transparent for the entire duration of the clock pulse, glitches on the input can propagate to the output, making timing analysis difficult in complex circuits.</li>
                </ul>

                <h2>2. The Flip-Flop: Edge-Triggered</h2>
                <p>
                    A Flip-Flop is **Edge-Triggered**. It only samples the input data ($D$) at a precise moment in time: the transition edge of the clock (usually the Rising Edge, $0 \to 1$).
                </p>
                <ul>
                    <li><strong>Sampling Event:</strong> On the rising edge of $CLK$, the flip-flop captures the value of $D$ and updates $Q$.</li>
                    <li><strong>Opaque Phase:</strong> At all other times (whether $CLK$ is 0 or 1), the flip-flop ignores changes on $D$. The output $Q$ remains stable.</li>
                    <li><strong>Structure:</strong> A standard D-Flip Flop is often constructed using two latches in a "Master-Slave" configuration. The Master captures on $CLK=0$, and the Slave updates on $CLK=1$.</li>
                    <li><strong>Advantage:</strong> This precise timing allows for synchronized systems where all elements update simultaneously, greatly simplifying timing closure and preventing race conditions.</li>
                </ul>

                <h2>3. Key Differences Table</h2>
                <div class="bg-slate-900 border border-slate-700 rounded-lg overflow-hidden my-6">
                    <table class="w-full text-sm text-left text-slate-300">
                        <thead class="text-xs text-indigo-400 uppercase bg-slate-950">
                            <tr>
                                <th class="px-6 py-3">Feature</th>
                                <th class="px-6 py-3">Latch</th>
                                <th class="px-6 py-3">Flip-Flop</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-800">
                            <tr>
                                <td class="px-6 py-3 font-bold">Triggering</td>
                                <td class="px-6 py-3">Level (High or Low)</td>
                                <td class="px-6 py-3">Edge (Rising or Falling)</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-bold">Glitches</td>
                                <td class="px-6 py-3 text-red-400">Propagates if CLK enabled</td>
                                <td class="px-6 py-3 text-green-400">Ignores glitches</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-bold">Area</td>
                                <td class="px-6 py-3">Smaller</td>
                                <td class="px-6 py-3">Larger (~2x Latches)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-8 text-center">
                    <button onclick="switchView('lab')" class="bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-4 rounded-xl font-bold transition shadow-lg shadow-indigo-500/30">
                        OPEN SIMULATION LAB &rarr;
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW 2: LAB -->
        <div id="view-lab" class="absolute inset-0 z-0 opacity-0 pointer-events-none flex p-6 gap-6 overflow-hidden">
            
            <!-- Left: Controls -->
            <div class="w-1/3 flex flex-col gap-4">
                <div class="glass-panel p-6">
                    <h2 class="text-indigo-400 font-bold mb-4 uppercase text-[10px] tracking-widest">Input Controls</h2>
                    
                    <div class="space-y-6">
                        <!-- Data Input -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300 font-bold">Data Input (D)</span>
                                <span id="val-data" class="font-mono text-white font-bold">0</span>
                            </div>
                            <button onmousedown="toggleData()" id="btn-data" class="w-full py-4 rounded-lg bg-slate-700 text-slate-300 font-bold border border-slate-600 shadow transition hover:bg-slate-600">
                                TOGGLE D (0)
                            </button>
                        </div>

                        <!-- Clock Control -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300 font-bold">Clock Signal (CLK)</span>
                                <span id="val-clk" class="font-mono text-white font-bold">0</span>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onmousedown="toggleClock()" id="btn-clk" class="py-3 rounded-lg bg-red-900/50 text-red-300 font-bold border border-red-800 hover:bg-red-800/50 transition">
                                    MANUAL CLK
                                </button>
                                <button onclick="toggleAuto()" id="btn-auto" class="py-3 rounded-lg bg-slate-800 text-slate-400 font-bold border border-slate-700 hover:text-white transition">
                                    AUTO RUN
                                </button>
                            </div>
                        </div>

                        <!-- Glitch Injection -->
                        <div class="pt-4 border-t border-slate-700">
                            <button onmousedown="injectGlitch()" class="w-full py-2 bg-yellow-900/30 text-yellow-400 text-xs font-bold border border-yellow-700 rounded hover:bg-yellow-900/50 transition flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                INJECT GLITCH (While CLK=1)
                            </button>
                            <p class="text-[9px] text-slate-500 mt-2 text-center">Observe how the Latch vs FF react to noise while Clock is High.</p>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-6 flex-grow flex flex-col">
                    <h2 class="text-slate-500 font-bold mb-4 uppercase text-[10px] tracking-widest">Logic Analyzer</h2>
                    <div class="flex-grow bg-[#0b0f19] rounded border border-slate-700 relative overflow-hidden">
                        <canvas id="waveCanvas" class="w-full h-full"></canvas>
                        <!-- Labels -->
                        <div class="absolute left-2 top-0 h-full pointer-events-none text-[9px] font-mono font-bold opacity-60">
                            <div class="absolute text-red-400" style="top: 30px">CLK</div>
                            <div class="absolute text-blue-400" style="top: 70px">DATA (D)</div>
                            <div class="absolute text-indigo-400" style="top: 110px">Q_LATCH</div>
                            <div class="absolute text-green-400" style="top: 150px">Q_FLIPFLOP</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Schematic Visualizer -->
            <div class="w-2/3 glass-panel p-1 flex flex-col relative overflow-hidden">
                <div class="absolute top-4 left-4 z-10 flex gap-2">
                    <div class="px-3 py-1 bg-slate-900/80 rounded border border-slate-700 text-[10px] text-slate-400 font-bold uppercase tracking-widest">
                        Parallel Logic Simulation
                    </div>
                </div>

                <div class="flex-grow bg-[#0f172a] relative overflow-hidden flex items-center justify-center p-8">
                    <svg id="circuit-svg" width="100%" height="100%" viewBox="0 0 600 400">
                        <defs>
                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                                <path d="M0,0 L10,5 L0,10" fill="#475569" />
                            </marker>
                        </defs>

                        <!-- Common Inputs -->
                        <text x="50" y="210" fill="#3b82f6" font-size="14" font-weight="bold">D</text>
                        <text x="50" y="380" fill="#ef4444" font-size="14" font-weight="bold">CLK</text>

                        <!-- Input Lines -->
                        <path d="M80,205 H150" class="wire" id="wire-d-main" />
                        <path d="M150,205 V100 H200" class="wire" id="wire-d-latch" />
                        <path d="M150,205 V300 H200" class="wire" id="wire-d-ff" />

                        <path d="M80,375 H170" class="wire wire-clk" id="wire-clk-main" />
                        <path d="M170,375 V140 H200" class="wire wire-clk" id="wire-clk-latch" />
                        <path d="M170,375 V340 H200" class="wire wire-clk" id="wire-clk-ff" />


                        <!-- TOP: D-LATCH -->
                        <g transform="translate(200, 60)">
                            <rect x="0" y="0" width="100" height="100" class="gate-body" id="body-latch" />
                            <text x="50" y="20" text-anchor="middle" class="tech-font" fill="#cbd5e1" font-size="10">D-LATCH</text>
                            <text x="50" y="90" text-anchor="middle" class="tech-font" fill="#64748b" font-size="8">Level Sensitive</text>
                            
                            <text x="10" y="45" fill="#cbd5e1" font-size="10">D</text>
                            <text x="10" y="85" fill="#cbd5e1" font-size="10">E</text>
                            <text x="80" y="45" fill="#cbd5e1" font-size="10">Q</text>

                            <!-- Internal state indicator -->
                            <rect x="40" y="40" width="20" height="20" fill="#1e293b" stroke="#334155" />
                            <text x="50" y="54" text-anchor="middle" fill="#fff" font-size="10" id="val-q-latch">0</text>
                        </g>
                        <!-- Latch Output -->
                        <line x1="300" y1="100" x2="450" y2="100" class="wire" id="wire-q-latch" />
                        <circle cx="450" cy="100" r="8" fill="#1e293b" stroke="#475569" id="led-latch" />
                        <text x="470" y="105" fill="#818cf8" font-size="12">Q_Latch</text>
                        <text x="350" y="90" fill="#818cf8" font-size="10" id="status-latch" opacity="0">TRANSPARENT</text>


                        <!-- BOTTOM: D-FLIP FLOP -->
                        <g transform="translate(200, 260)">
                            <rect x="0" y="0" width="100" height="100" class="gate-body" id="body-ff" />
                            <text x="50" y="20" text-anchor="middle" class="tech-font" fill="#cbd5e1" font-size="10">D-FLIP FLOP</text>
                            <text x="50" y="90" text-anchor="middle" class="tech-font" fill="#64748b" font-size="8">Edge Triggered</text>

                            <text x="10" y="45" fill="#cbd5e1" font-size="10">D</text>
                            <text x="15" y="85" fill="#cbd5e1" font-size="10">></text> <!-- Clock triangle -->
                            <text x="80" y="45" fill="#cbd5e1" font-size="10">Q</text>

                            <!-- Internal state indicator -->
                            <rect x="40" y="40" width="20" height="20" fill="#1e293b" stroke="#334155" />
                            <text x="50" y="54" text-anchor="middle" fill="#fff" font-size="10" id="val-q-ff">0</text>
                        </g>
                        <!-- FF Output -->
                        <line x1="300" y1="300" x2="450" y2="300" class="wire" id="wire-q-ff" />
                        <circle cx="450" cy="300" r="8" fill="#1e293b" stroke="#475569" id="led-ff" />
                        <text x="470" y="305" fill="#4ade80" font-size="12">Q_FF</text>
                        <text x="350" y="290" fill="#4ade80" font-size="10" id="status-ff" opacity="0">SAMPLED!</text>

                    </svg>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- State ---
        let data = 0;
        let clk = 0;
        let qLatch = 0;
        let qFF = 0;
        
        let isAuto = false;
        let simTime = 0;
        let history = [];
        const MAX_HISTORY = 400;

        // DOM
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        const btnData = document.getElementById('btn-data');
        const btnClk = document.getElementById('btn-clk');
        const btnAuto = document.getElementById('btn-auto');
        
        // Wires
        const wDMain = document.getElementById('wire-d-main');
        const wDLatch = document.getElementById('wire-d-latch');
        const wDFf = document.getElementById('wire-d-ff');
        const wClkMain = document.getElementById('wire-clk-main');
        const wClkLatch = document.getElementById('wire-clk-latch');
        const wClkFf = document.getElementById('wire-clk-ff');
        const wQLatch = document.getElementById('wire-q-latch');
        const wQFf = document.getElementById('wire-q-ff');
        
        // Components
        const bodyLatch = document.getElementById('body-latch');
        const bodyFF = document.getElementById('body-ff');
        const ledLatch = document.getElementById('led-latch');
        const ledFF = document.getElementById('led-ff');
        const statusLatch = document.getElementById('status-latch');
        const statusFF = document.getElementById('status-ff');

        // --- Logic ---
        function toggleData() {
            data = data ? 0 : 1;
            updateLogic(false); // Not a clock edge
            updateUI();
        }

        function toggleClock() {
            const prevClk = clk;
            clk = clk ? 0 : 1;
            const isRisingEdge = (prevClk === 0 && clk === 1);
            updateLogic(isRisingEdge);
            updateUI();
        }

        function toggleAuto() {
            isAuto = !isAuto;
            btnAuto.classList.toggle('bg-indigo-600', isAuto);
            btnAuto.classList.toggle('text-white', isAuto);
            btnAuto.innerText = isAuto ? "STOP AUTO" : "AUTO RUN";
        }

        function injectGlitch() {
            if (clk === 1) {
                // Flash data
                data = data ? 0 : 1;
                updateLogic(false);
                updateUI();
                setTimeout(() => {
                    data = data ? 0 : 1;
                    updateLogic(false);
                    updateUI();
                }, 200);
            } else {
                alert("Clock must be HIGH to demonstrate 'Transparency Glitch'.");
            }
        }

        function updateLogic(isRisingEdge) {
            // Latch Logic: Transparent when CLK=1
            if (clk === 1) {
                qLatch = data;
                statusLatch.style.opacity = 1;
                statusLatch.innerText = "TRANSPARENT";
                statusLatch.setAttribute('fill', '#fbbf24');
                bodyLatch.classList.add('gate-active');
            } else {
                statusLatch.innerText = "LATCHED";
                statusLatch.setAttribute('fill', '#94a3b8');
                bodyLatch.classList.remove('gate-active');
            }

            // FF Logic: Update only on Rising Edge
            if (isRisingEdge) {
                qFF = data;
                statusFF.style.opacity = 1;
                setTimeout(() => statusFF.style.opacity = 0, 500); // Flash message
                bodyFF.classList.add('gate-active');
                setTimeout(() => bodyFF.classList.remove('gate-active'), 200);
            }
        }

        function updateUI() {
            document.getElementById('val-data').innerText = data;
            document.getElementById('val-clk').innerText = clk;
            document.getElementById('val-q-latch').innerText = qLatch;
            document.getElementById('val-q-ff').innerText = qFF;

            btnData.innerText = `TOGGLE D (${data})`;
            btnData.className = data ? "w-full py-4 rounded-lg bg-blue-600 text-white font-bold border border-blue-500 shadow" : "w-full py-4 rounded-lg bg-slate-700 text-slate-300 font-bold border border-slate-600 shadow";

            btnClk.className = clk ? "py-3 rounded-lg bg-red-600 text-white font-bold border border-red-500 shadow" : "py-3 rounded-lg bg-slate-800 text-red-300 font-bold border border-red-900/50";

            // Wires
            const setW = (el, val) => el.setAttribute('class', `wire ${val ? 'wire-active' : ''}`);
            setW(wDMain, data);
            setW(wDLatch, data);
            setW(wDFf, data);
            
            // Clocks
            const clkClass = clk ? "wire wire-clk wire-clk-high" : "wire wire-clk";
            wClkMain.setAttribute('class', clkClass);
            wClkLatch.setAttribute('class', clkClass);
            wClkFf.setAttribute('class', clkClass);

            // Outputs
            wQLatch.setAttribute('class', `wire ${qLatch ? 'wire-active' : ''}`);
            ledLatch.setAttribute('fill', qLatch ? '#fbbf24' : '#1e293b');
            
            wQFf.setAttribute('class', `wire ${qFF ? 'wire-active' : ''}`);
            ledFF.setAttribute('fill', qFF ? '#4ade80' : '#1e293b');
        }

        // --- Loop ---
        function step() {
            simTime++;

            if (isAuto) {
                if (simTime % 40 === 0) { // Clock period
                    toggleClock();
                }
                // Random data changes occasionally
                if (simTime % 120 === 0 && Math.random() > 0.5) {
                    toggleData();
                }
            }

            // History
            history.push({ clk, data, qLatch, qFF });
            if (history.length > MAX_HISTORY) history.shift();

            drawWaveforms();
            requestAnimationFrame(step);
        }

        function drawWaveforms() {
            if(canvas.width !== canvas.offsetWidth) {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.parentElement.clientHeight;
            }
            const w = canvas.width;
            const h = canvas.height;
            const stepWidth = w / MAX_HISTORY;

            ctx.clearRect(0,0,w,h);

            const lanes = [
                { id: 'clk', y: 30, c: '#ef4444' },
                { id: 'data', y: 70, c: '#3b82f6' },
                { id: 'qLatch', y: 110, c: '#818cf8' },
                { id: 'qFF', y: 150, c: '#4ade80' }
            ];

            lanes.forEach(lane => {
                ctx.strokeStyle = lane.c;
                ctx.lineWidth = 2;
                ctx.beginPath();
                for(let i=0; i<history.length; i++) {
                    const val = history[i][lane.id];
                    const x = i * stepWidth;
                    const y = val ? lane.y - 12 : lane.y + 12;

                    if(i===0) ctx.moveTo(x, y);
                    else {
                        if (history[i-1][lane.id] !== val) ctx.lineTo(x, val ? lane.y+12 : lane.y-12);
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();

                ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                ctx.lineWidth = 1;
                ctx.beginPath(); ctx.moveTo(0, lane.y); ctx.lineTo(w, lane.y); ctx.stroke();
            });
        }

        // View Switching
        function switchView(v) {
            const theory = document.getElementById('view-theory');
            const lab = document.getElementById('view-lab');
            const btnT = document.getElementById('btn-theory');
            const btnL = document.getElementById('btn-lab');

            if (v === 'theory') {
                theory.classList.remove('opacity-0', 'pointer-events-none'); theory.classList.add('z-10');
                lab.classList.add('opacity-0', 'pointer-events-none'); lab.classList.remove('z-10');
                btnT.classList.add('tab-active'); btnL.classList.remove('tab-active');
            } else {
                lab.classList.remove('opacity-0', 'pointer-events-none'); lab.classList.add('z-10');
                theory.classList.add('opacity-0', 'pointer-events-none'); theory.classList.remove('z-10');
                btnL.classList.add('tab-active'); btnT.classList.remove('tab-active');
            }
        }

        // Init
        updateUI();
        requestAnimationFrame(step);

    </script>
</body>
</html>
