<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Timing Analysis (STA) - EcrioniX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <!-- MathJax -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #020617; color: #f8fafc; overflow: hidden; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }

        .watermark {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900; color: rgba(99, 102, 241, 0.03);
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
        }

        /* Tabs */
        .tab-btn {
            @apply px-4 py-2 text-xs font-bold rounded-lg transition-all border border-transparent text-slate-400 uppercase tracking-wider;
        }
        .tab-active {
            @apply bg-indigo-600 text-white border-indigo-500 shadow-lg shadow-indigo-500/30;
        }

        input[type=range] { accent-color: #6366f1; }

        /* Circuit Visuals */
        .wire { fill: none; stroke: #475569; stroke-width: 2; }
        .wire-active { stroke: #fbbf24; filter: drop-shadow(0 0 3px #fbbf24); }
        .ff-box { fill: #1e293b; stroke: #94a3b8; stroke-width: 2; }
        .cloud { fill: #1e293b; stroke: #64748b; stroke-width: 2; stroke-dasharray: 4 2; }
        
        /* Waveform */
        .wave-canvas { background: #0b0f19; border-radius: 8px; border: 1px solid #334155; }
        
        /* Violations */
        .violating { color: #ef4444; text-shadow: 0 0 10px rgba(239,68,68,0.5); }
        .passing { color: #4ade80; text-shadow: 0 0 10px rgba(74,222,128,0.5); }

        /* Theory */
        .prose h1 { @apply text-2xl font-bold text-white mb-4 tech-font border-b border-slate-800 pb-2; }
        .prose h2 { @apply text-lg font-bold text-indigo-400 mt-6 mb-2 uppercase tracking-wider; }
        .prose p { @apply text-sm text-slate-400 mb-3 leading-relaxed; }
        .prose strong { @apply text-white font-semibold; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <div class="watermark">EcrioniX STA</div>

    <!-- Header -->
    <nav class="border-b border-slate-800 bg-slate-900/80 px-6 py-4 flex justify-between items-center z-20">
        <div>
            <h1 class="text-2xl font-bold text-indigo-400 tech-font uppercase">STATIC TIMING <span class="text-white">ANALYSIS</span></h1>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Setup & Hold Verification Lab</p>
        </div>
        
        <div class="flex bg-slate-950 p-1 rounded-xl border border-slate-800">
            <button onclick="switchView('theory')" id="btn-theory" class="tab-btn tab-active">Concepts</button>
            <button onclick="switchView('lab')" id="btn-lab" class="tab-btn">Analysis Lab</button>
        </div>

        <button onclick="window.history.back()" class="group flex items-center text-slate-400 hover:text-white transition bg-slate-800/80 px-4 py-2 rounded-lg border border-slate-700 hover:border-indigo-500">
            <span class="text-xs font-bold uppercase">Exit Lab</span>
        </button>
    </nav>

    <!-- Content -->
    <div class="flex-grow relative overflow-hidden">

        <!-- THEORY VIEW -->
        <div id="view-theory" class="absolute inset-0 z-10 overflow-y-auto p-8 flex justify-center">
            <div class="max-w-4xl w-full glass-panel p-10 prose">
                <h1>Timing Constraints Explained</h1>
                <p>
                    <strong>Static Timing Analysis (STA)</strong> is a method of validating the timing performance of a design by checking all possible paths for timing violations without performing a simulation.
                </p>

                <h2>1. Setup Time ($T_{setup}$)</h2>
                <p>
                    The minimum amount of time the data signal must be stable <strong>before</strong> the clock edge arrives. 
                </p>
                <div class="bg-indigo-500/10 border-l-4 border-indigo-500 p-4 my-2">
                    <p class="text-white">Violation Condition: Data arrives too late.</p>
                    <p class="mono-font text-xs text-indigo-300">Slack = Required Time - Arrival Time</p>
                    <p class="mono-font text-xs text-indigo-300">Slack = (Tclk + Tskew - Tsetup) - (Tcq + Tlogic)</p>
                </div>
                <p><strong>Fix:</strong> Reduce logic depth, improve cell drive strength, or slow down the clock (increase $T_{clk}$).</p>

                <h2>2. Hold Time ($T_{hold}$)</h2>
                <p>
                    The minimum amount of time the data signal must remain stable <strong>after</strong> the clock edge arrives.
                </p>
                <div class="bg-indigo-500/10 border-l-4 border-pink-500 p-4 my-2">
                    <p class="text-white">Violation Condition: Data changes too fast (Race Condition).</p>
                    <p class="mono-font text-xs text-pink-300">Slack = Arrival Time - Required Time</p>
                    <p class="mono-font text-xs text-pink-300">Slack = (Tcq + Tlogic) - (Tskew + Thold)</p>
                </div>
                <p><strong>Fix:</strong> Add delay buffers to the data path. Slowing the clock does <strong>NOT</strong> fix hold violations.</p>

                <div class="mt-8 text-center">
                    <button onclick="switchView('lab')" class="bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded-xl font-bold transition">Start Analysis &rarr;</button>
                </div>
            </div>
        </div>

        <!-- LAB VIEW -->
        <div id="view-lab" class="absolute inset-0 z-0 opacity-0 pointer-events-none flex p-6 gap-6">
            
            <!-- Left: Controls -->
            <div class="w-80 flex flex-col gap-4 overflow-y-auto pr-2">
                <div class="glass-panel p-6">
                    <h2 class="text-indigo-400 font-bold mb-4 uppercase text-[10px] tracking-widest">Environment Parameters</h2>
                    
                    <div class="space-y-6">
                        <!-- Frequency -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300">Clock Period ($T_{clk}$)</span>
                                <span id="val-tclk" class="font-mono text-white font-bold">10 ns</span>
                            </div>
                            <input type="range" id="slider-tclk" min="2" max="20" step="0.5" value="10" class="w-full">
                        </div>

                        <!-- Logic Delay -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300">Combinational Delay ($T_{logic}$)</span>
                                <span id="val-tlogic" class="font-mono text-yellow-400 font-bold">5.0 ns</span>
                            </div>
                            <input type="range" id="slider-tlogic" min="1" max="15" step="0.1" value="5" class="w-full">
                            <p class="text-[9px] text-slate-500 mt-1">Represents gate delays between Flops.</p>
                        </div>

                        <!-- Skew -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300">Clock Skew ($T_{skew}$)</span>
                                <span id="val-tskew" class="font-mono text-blue-400 font-bold">0.0 ns</span>
                            </div>
                            <input type="range" id="slider-tskew" min="-2" max="2" step="0.1" value="0" class="w-full">
                            <p class="text-[9px] text-slate-500 mt-1">Positive: Capture clock arrives later.</p>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-6">
                    <h2 class="text-slate-500 font-bold mb-4 uppercase text-[10px] tracking-widest">Library Specs</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-slate-400">$T_{setup}$</span>
                            <div class="flex items-center gap-2">
                                <input type="number" id="inp-tsetup" value="1.0" step="0.1" class="w-16 bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right text-white font-mono focus:border-indigo-500 outline-none">
                                <span class="text-slate-500">ns</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-slate-400">$T_{hold}$</span>
                            <div class="flex items-center gap-2">
                                <input type="number" id="inp-thold" value="0.5" step="0.1" class="w-16 bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right text-white font-mono focus:border-indigo-500 outline-none">
                                <span class="text-slate-500">ns</span>
                            </div>
                        </div>
                         <div class="flex justify-between items-center text-xs">
                            <span class="text-slate-400">$T_{cq}$ (Clk-to-Q)</span>
                            <div class="flex items-center gap-2">
                                <input type="number" id="inp-tcq" value="1.0" step="0.1" class="w-16 bg-slate-900 border border-slate-700 rounded px-2 py-1 text-right text-white font-mono focus:border-indigo-500 outline-none">
                                <span class="text-slate-500">ns</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Visualization & Report -->
            <div class="flex-grow flex flex-col gap-6">
                
                <!-- Circuit Diagram -->
                <div class="glass-panel p-1 h-64 relative flex items-center justify-center bg-slate-900/50">
                    <div class="absolute top-3 left-4 text-[10px] uppercase font-bold text-slate-500 tracking-widest">Reg-to-Reg Path</div>
                    
                    <svg id="circuit-svg" width="600" height="200" viewBox="0 0 600 200">
                        <!-- Launch FF -->
                        <g transform="translate(100, 80)">
                            <rect x="0" y="0" width="50" height="60" class="ff-box" rx="2" />
                            <text x="25" y="35" text-anchor="middle" fill="#cbd5e1" font-size="10" font-family="monospace">UFF1</text>
                            <text x="25" y="75" text-anchor="middle" fill="#94a3b8" font-size="9">Launch</text>
                            <path d="M0,50 L5,45 L0,40" fill="none" stroke="#94a3b8" /> <!-- Clk -->
                        </g>

                        <!-- Combinational Logic Cloud -->
                        <path d="M180,110 Q200,80 230,110 Q260,140 290,110 Q320,80 350,110 Q350,130 320,130 Q290,130 260,150 Q230,130 180,130 Z" class="cloud" transform="translate(0,-10)" />
                        <text x="265" y="115" text-anchor="middle" fill="#fbbf24" font-size="10" font-family="monospace">COMBO LOGIC</text>

                        <!-- Capture FF -->
                        <g transform="translate(380, 80)">
                            <rect x="0" y="0" width="50" height="60" class="ff-box" rx="2" />
                            <text x="25" y="35" text-anchor="middle" fill="#cbd5e1" font-size="10" font-family="monospace">UFF2</text>
                            <text x="25" y="75" text-anchor="middle" fill="#94a3b8" font-size="9">Capture</text>
                            <path d="M0,50 L5,45 L0,40" fill="none" stroke="#94a3b8" />
                        </g>

                        <!-- Wires -->
                        <line x1="150" y1="110" x2="180" y2="110" class="wire" />
                        <line x1="350" y1="110" x2="380" y2="110" class="wire" />

                        <!-- Clocks -->
                        <path d="M80,150 H100 V130" class="wire" stroke="#ef4444" /> <!-- Launch Clk -->
                        <path d="M360,150 H380 V130" class="wire" stroke="#3b82f6" /> <!-- Cap Clk -->
                        <circle cx="360" cy="150" r="3" fill="#facc15" /> <!-- Skew point -->
                        
                        <!-- Visualizing Delay -->
                        <text x="265" y="70" text-anchor="middle" fill="#facc15" font-size="10" id="anim-delay">5.0ns</text>
                    </svg>
                </div>

                <!-- Timing Diagram -->
                <div class="glass-panel p-4 flex-grow flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Timing Waveform</h2>
                        <div class="flex gap-4 text-[10px] font-mono">
                            <span class="text-red-400">Launch CLK</span>
                            <span class="text-blue-400">Capture CLK</span>
                            <span class="text-yellow-400">Data</span>
                        </div>
                    </div>
                    <div class="flex-grow bg-[#0b0f19] rounded relative overflow-hidden">
                        <canvas id="timingCanvas" width="800" height="300" class="w-full h-full"></canvas>
                    </div>
                </div>

                <!-- Reporting -->
                <div class="grid grid-cols-2 gap-6 h-32">
                    <div class="glass-panel p-4 flex flex-col justify-center items-center">
                        <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">Setup Check</div>
                        <div id="setup-slack" class="text-3xl font-bold mono-font passing">+2.00 ns</div>
                        <div id="setup-msg" class="text-xs text-slate-400 mt-1">Timing Met</div>
                    </div>
                    <div class="glass-panel p-4 flex flex-col justify-center items-center">
                        <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">Hold Check</div>
                        <div id="hold-slack" class="text-3xl font-bold mono-font passing">+4.50 ns</div>
                        <div id="hold-msg" class="text-xs text-slate-400 mt-1">Timing Met</div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script>
        // --- State ---
        let Tclk = 10.0;
        let Tlogic = 5.0;
        let Tskew = 0.0;
        let Tsetup = 1.0;
        let Thold = 0.5;
        let Tcq = 1.0;

        // --- DOM ---
        const sTclk = document.getElementById('slider-tclk');
        const sTlogic = document.getElementById('slider-tlogic');
        const sTskew = document.getElementById('slider-tskew');
        
        const iTsetup = document.getElementById('inp-tsetup');
        const iThold = document.getElementById('inp-thold');
        const iTcq = document.getElementById('inp-tcq');

        const vTclk = document.getElementById('val-tclk');
        const vTlogic = document.getElementById('val-tlogic');
        const vTskew = document.getElementById('val-tskew');
        
        const dispSetup = document.getElementById('setup-slack');
        const dispHold = document.getElementById('hold-slack');
        const msgSetup = document.getElementById('setup-msg');
        const msgHold = document.getElementById('hold-msg');
        const animDelay = document.getElementById('anim-delay');

        const canvas = document.getElementById('timingCanvas');
        const ctx = canvas.getContext('2d');

        // --- View Logic ---
        function switchView(v) {
            const theory = document.getElementById('view-theory');
            const lab = document.getElementById('view-lab');
            const btnT = document.getElementById('btn-theory');
            const btnL = document.getElementById('btn-lab');

            if (v === 'theory') {
                theory.classList.remove('opacity-0', 'pointer-events-none'); theory.classList.add('z-10');
                lab.classList.add('opacity-0', 'pointer-events-none'); lab.classList.remove('z-10');
                btnT.classList.add('tab-active'); btnL.classList.remove('tab-active');
            } else {
                lab.classList.remove('opacity-0', 'pointer-events-none'); lab.classList.add('z-10');
                theory.classList.add('opacity-0', 'pointer-events-none'); theory.classList.remove('z-10');
                btnL.classList.add('tab-active'); btnT.classList.remove('tab-active');
                resizeCanvas();
                updateAnalysis();
            }
        }

        // --- Analysis Core ---
        function updateAnalysis() {
            // Read Inputs
            Tclk = parseFloat(sTclk.value);
            Tlogic = parseFloat(sTlogic.value);
            Tskew = parseFloat(sTskew.value);
            Tsetup = parseFloat(iTsetup.value);
            Thold = parseFloat(iThold.value);
            Tcq = parseFloat(iTcq.value);

            // Update Labels
            vTclk.innerText = Tclk.toFixed(1) + " ns";
            vTlogic.innerText = Tlogic.toFixed(1) + " ns";
            vTskew.innerText = Tskew.toFixed(1) + " ns";
            animDelay.innerText = Tlogic.toFixed(1) + "ns";

            // Calculations
            
            // 1. Data Arrival Time (Launch Edge @ 0 + Delay)
            const dataArrival = Tcq + Tlogic;

            // 2. Data Required Time (Setup)
            // Capture Edge @ Tclk + Skew
            // Req = Capture Time - Setup
            const captureEdge = Tclk + Tskew;
            const dataRequiredSetup = captureEdge - Tsetup;

            const setupSlack = dataRequiredSetup - dataArrival;

            // 3. Data Required Time (Hold)
            // Hold check is usually against same edge or next?
            // In single cycle: Hold check ensures data from launch edge 0 doesn't overwrite data at capture edge 0 + skew.
            // Simplified: Fast data shouldn't race through to capture FF before hold time.
            // Check against previous capture edge (which is at Skew relative to Launch 0)
            // Ideally: Arrival > CaptureEdge_prev + Hold
            // Arrival = Tcq + Tlogic.
            // CaptureEdge_prev = Tskew.
            const dataRequiredHold = Tskew + Thold;
            
            const holdSlack = dataArrival - dataRequiredHold;

            // Update UI
            updateSlackDisplay(dispSetup, msgSetup, setupSlack, "VIOLATED: Slow Down Clock or Reduce Logic Delay");
            updateSlackDisplay(dispHold, msgHold, holdSlack, "VIOLATED: Fix Race Condition (Add Buffers)");

            drawWaveform(dataArrival, dataRequiredSetup, dataRequiredHold, captureEdge);
        }

        function updateSlackDisplay(el, msgEl, slack, failMsg) {
            el.innerText = (slack >= 0 ? "+" : "") + slack.toFixed(2) + " ns";
            if (slack < 0) {
                el.className = "text-3xl font-bold mono-font violating";
                msgEl.innerText = failMsg;
                msgEl.className = "text-xs text-red-400 mt-1 font-bold";
            } else {
                el.className = "text-3xl font-bold mono-font passing";
                msgEl.innerText = "Timing Met";
                msgEl.className = "text-xs text-emerald-400 mt-1";
            }
        }

        // --- Drawing ---
        function resizeCanvas() {
            if(canvas.parentElement) {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
            }
            updateAnalysis(); // Redraw
        }
        window.addEventListener('resize', resizeCanvas);

        function drawWaveform(arrival, reqSetup, reqHold, captureT) {
            if(!ctx) return;
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0,0,w,h);

            // Scale: Map 0 to (Tclk * 2) to width
            const timeSpan = Tclk * 1.5 + Math.abs(Tskew) + 5;
            const pxPerNs = (w - 40) / timeSpan;
            const startX = 20;

            const toX = (t) => startX + t * pxPerNs;
            
            // Helper: Draw Clock Pulse
            const drawClock = (y, offset, color) => {
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                // 0 to offset: Low
                ctx.moveTo(toX(0), y+15);
                // Launch Edge (Rising)
                // Draw multiple cycles
                for(let t = 0; t < timeSpan; t += Tclk) {
                    const edge = t + offset;
                    // Low before edge
                    ctx.lineTo(toX(edge), y+15);
                    // Rise
                    ctx.lineTo(toX(edge), y-15);
                    // High
                    ctx.lineTo(toX(edge + Tclk/2), y-15);
                    // Fall
                    ctx.lineTo(toX(edge + Tclk/2), y+15);
                    ctx.lineTo(toX(edge + Tclk), y+15);
                }
                ctx.stroke();
            };

            // 1. Launch Clock (Red)
            drawClock(50, 0, '#f87171');

            // 2. Capture Clock (Blue)
            drawClock(120, Tskew, '#60a5fa');
            
            // Mark Capture Edge
            ctx.strokeStyle = '#3b82f6';
            ctx.setLineDash([5,5]);
            ctx.beginPath();
            ctx.moveTo(toX(captureT), 20);
            ctx.lineTo(toX(captureT), h);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#3b82f6';
            ctx.fillText("Capture Edge", toX(captureT) + 5, 200);

            // 3. Data Path (Yellow)
            const yData = 180;
            // Valid data starts at Arrival Time
            // Previous data valid until Arrival Time
            
            // Draw "Invalid/Transition" region (X)
            // From 0 to Tcq (Launch delay)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(toX(0), yData-10, toX(arrival)-toX(0), 20);
            
            // Valid Data
            ctx.fillStyle = '#fbbf24';
            ctx.fillRect(toX(arrival), yData-10, toX(timeSpan)-toX(arrival), 20);
            
            // Setup Window (Shaded Red)
            // [ReqSetup, CaptureT]
            ctx.fillStyle = 'rgba(239, 68, 68, 0.3)';
            ctx.fillRect(toX(reqSetup), 100, toX(captureT) - toX(reqSetup), 150);
            ctx.strokeStyle = '#ef4444';
            ctx.strokeRect(toX(reqSetup), 100, toX(captureT) - toX(reqSetup), 150);
            ctx.fillText("Tsetup", toX(reqSetup), 260);

            // Hold Window (Shaded Pink)
            // [CaptureT_prev, CaptureT_prev + Hold]
            // For Hold check relative to launch edge influence:
            // Check against Skew (effective capture edge for race)
            // Window: [Tskew, Tskew + Thold]
            ctx.fillStyle = 'rgba(236, 72, 153, 0.3)';
            ctx.fillRect(toX(Tskew), 100, toX(Tskew + Thold) - toX(Tskew), 150);
            ctx.fillText("Thold", toX(Tskew), 280);

            // Data Arrival Marker
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(toX(arrival), yData-20);
            ctx.lineTo(toX(arrival), yData+20);
            ctx.stroke();
            ctx.fillStyle = '#fff';
            ctx.fillText("Arrival", toX(arrival), yData-25);

        }

        // Listeners
        [sTclk, sTlogic, sTskew, iTsetup, iThold, iTcq].forEach(el => {
            el.addEventListener('input', updateAnalysis);
        });

        // Init
        // resizeCanvas called on switch view or load

    </script>
</body>
</html>
