<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6672302762343789"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXZS8C1FLY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XXZS8C1FLY');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Synchronizer Lab - EcrioniX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .tech-font { font-family: 'Orbitron', sans-serif; }
        .code-font { font-family: 'JetBrains Mono', monospace; }
        
        /* Watermark */
        .watermark {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 8rem; font-weight: 900;
            color: rgba(99, 102, 241, 0.03);
            pointer-events: none; user-select: none; z-index: 0;
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        /* Component Styling */
        .ff-box { fill: #1e293b; stroke: #94a3b8; stroke-width: 2; transition: all 0.3s; }
        .ff-active { stroke: #ef4444; fill: #450a0a; }
        .comp-text { font-family: 'Orbitron', sans-serif; fill: #cbd5e1; font-size: 10px; }
        
        /* Signal Wires */
        .wire { fill: none; stroke: #475569; stroke-width: 3; transition: stroke 0.1s; }
        .wire-active { stroke: #ef4444; filter: drop-shadow(0 0 3px #ef4444); }
        .wire-low { stroke: #1e293b; opacity: 0.5; }
        .wire-stable { stroke: #4ade80; filter: drop-shadow(0 0 3px #4ade80); }
        .wire-clk { stroke: #facc15; }

        /* Waveform Canvas */
        .wave-canvas {
            background-color: #111827;
            border-left: 2px solid #374151;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Toggle Switches */
        .switch-btn {
            @apply px-6 py-4 rounded-xl font-bold transition-all border-b-4 active:border-b-0 active:translate-y-1;
        }
        .btn-rst-on { @apply bg-red-600 border-red-800 text-white shadow-lg shadow-red-900/40; }
        .btn-rst-off { @apply bg-slate-700 border-slate-900 text-slate-400; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col relative overflow-x-hidden">

    <div class="watermark">EcrioniX Labs</div>

    <div class="max-w-[1400px] mx-auto w-full flex-grow relative z-10">
        
        <!-- Header -->
        <nav class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-gray-700 pb-4">
            <div>
                <h1 class="text-3xl font-bold text-white tech-font tracking-wide">RESET <span class="text-indigo-500">SYNCHRONIZER</span></h1>
                <p class="text-gray-400 text-sm">Asynchronous Assertion, Synchronous De-assertion (ARSR)</p>
            </div>
            
            <div class="mt-4 md:mt-0 flex items-center gap-4">
                <div class="bg-gray-800 px-4 py-2 rounded border border-gray-600 text-center">
                    <div class="text-[10px] text-gray-500 uppercase font-bold">Release Status</div>
                    <div id="release-status" class="text-green-400 font-mono font-bold">SAFE</div>
                </div>
                <button onclick="window.history.back()" class="group flex items-center text-slate-400 hover:text-white transition bg-slate-800/80 px-4 py-2 rounded-lg border border-slate-700 hover:border-indigo-500">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    <span class="text-xs font-bold uppercase tracking-wider">Exit Lab</span>
                </button>
            </div>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- LEFT: Controls & Theory -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Main Control Card -->
                <div class="glass-panel rounded-2xl p-6 shadow-2xl">
                    <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-6">Interaction Bench</h2>
                    
                    <div class="space-y-6">
                        <!-- Reset Toggle -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300 font-bold tracking-tight">ASYNC RESET INPUT</span>
                                <span id="val-async" class="font-mono text-red-400">0</span>
                            </div>
                            <button id="btn-rst" onmousedown="toggleReset()" class="switch-btn btn-rst-off w-full">
                                ASSERT ASYNC RESET
                            </button>
                        </div>

                        <!-- Manual Clock -->
                        <div>
                            <div class="flex justify-between text-xs mb-2">
                                <span class="text-slate-300 font-bold">SYSTEM CLOCK</span>
                                <span id="val-clk" class="font-mono text-yellow-400">0</span>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <button onmousedown="pulseClock()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl border-b-4 border-indigo-800 active:border-b-0 active:translate-y-1 transition-all">PULSE</button>
                                <button id="btn-auto" onclick="toggleAuto()" class="bg-slate-800 text-slate-400 font-bold py-3 rounded-xl border-b-4 border-slate-950 active:border-b-0 active:translate-y-1 transition-all">AUTO</button>
                            </div>
                        </div>

                        <!-- Lab State Reset -->
                        <div class="pt-4 border-t border-slate-700">
                             <button onclick="resetLabState()" class="w-full py-3 bg-red-900/20 hover:bg-red-900/30 text-red-400 font-bold rounded-xl border border-red-800/50 transition-all active:scale-95 flex items-center justify-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                RESET LAB STATE
                             </button>
                        </div>
                    </div>
                </div>

                <!-- Theory Card -->
                <div class="bg-slate-900/50 border border-slate-800 rounded-2xl p-6">
                    <h3 class="text-xs font-bold text-indigo-400 mb-3 uppercase tracking-wider">The "Reset-Release" Problem</h3>
                    <div class="text-xs text-slate-400 space-y-3 leading-relaxed">
                        <p>
                            If an asynchronous reset is released (goes 1&rarr;0) exactly at the rising edge of the clock, some Flip-Flops in the chip might see the reset, while others don't.
                        </p>
                        <p>
                            The <strong class="text-white">Reset Synchronizer</strong> ensures that while the reset is applied immediately, its removal is delayed and aligned to the clock edge.
                        </p>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Schematic & Waveforms -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Schematic -->
                <div class="glass-panel rounded-2xl p-1 relative overflow-hidden h-72">
                    <div class="absolute top-3 left-4 text-[10px] font-bold text-slate-600 tracking-widest">INTERNAL RTL ARCHITECTURE</div>
                    
                    <div class="w-full h-full flex items-center justify-center">
                        <svg id="schematic" width="100%" height="100%" viewBox="0 0 600 200">
                            <!-- Input Wire -->
                            <text x="30" y="55" class="comp-text" font-size="12">VCC (1)</text>
                            <line id="w-vcc" x1="60" y1="50" x2="120" y2="50" class="wire wire-stable" />

                            <!-- FF 1 -->
                            <g transform="translate(120, 30)">
                                <rect id="ff1-body" width="60" height="80" rx="4" class="ff-box" />
                                <text x="30" y="45" text-anchor="middle" class="comp-text">FF_1</text>
                                <path d="M0,60 L10,70 L0,80" fill="none" stroke="#94a3b8" />
                            </g>

                            <!-- Wire 1-2 -->
                            <line id="w-q1" x1="180" y1="50" x2="250" y2="50" class="wire" />

                            <!-- FF 2 -->
                            <g transform="translate(250, 30)">
                                <rect id="ff2-body" width="60" height="80" rx="4" class="ff-box" />
                                <text x="30" y="45" text-anchor="middle" class="comp-text">FF_2</text>
                                <path d="M0,60 L10,70 L0,80" fill="none" stroke="#94a3b8" />
                            </g>

                            <!-- Output Wire -->
                            <line id="w-out" x1="310" y1="50" x2="400" y2="50" class="wire" />
                            <text x="410" y="55" class="comp-text" font-size="12" fill="#fff">RST_SYNC_OUT</text>

                            <!-- Async Reset Line -->
                            <text x="235" y="165" class="comp-text" fill="#ef4444">ASYNC_RST_IN</text>
                            <path id="w-async" d="M150,150 V110 M280,150 V110 M150,150 H450" class="wire" stroke="#ef4444" />
                            
                            <!-- Clock Line -->
                            <text x="30" y="145" class="comp-text" fill="#facc15">CLK</text>
                            <path id="w-clk" d="M60,140 H280 M120,140 V100 M250,140 V100" class="wire wire-clk" />
                        </svg>
                    </div>
                </div>

                <!-- Waveforms -->
                <div class="bg-gray-900 rounded-2xl border border-slate-800 overflow-hidden">
                    <div class="bg-slate-800 px-4 py-2 flex justify-between items-center border-b border-slate-700">
                        <span class="text-xs font-bold text-slate-300 uppercase tracking-widest">Waveform Analyzer</span>
                        <div class="flex gap-4 text-[10px] font-mono">
                            <span class="text-yellow-400">CLK</span>
                            <span class="text-red-400">ASYNC_RST_IN</span>
                            <span class="text-green-400">RST_SYNC_OUT</span>
                        </div>
                    </div>
                    <div class="p-2 relative min-h-[220px]">
                        <canvas id="waveCanvas" height="220" width="800" class="wave-canvas w-full"></canvas>
                        
                        <!-- Fixed Signal Labels -->
                        <div class="absolute left-2 top-0 h-full pointer-events-none text-[10px] font-mono font-bold">
                            <div class="absolute text-yellow-500" style="top: 30px">CLK</div>
                            <div class="absolute text-red-400" style="top: 80px">ASYNC_RST_IN</div>
                            <div class="absolute text-indigo-300" style="top: 130px">SYNC_STAGE_1</div>
                            <div class="absolute text-green-400" style="top: 180px">RST_SYNC_OUT</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- State ---
        let asyncRstIn = 0;
        let clk = 0;
        let ff1 = 0;
        let ff2 = 0;
        
        let isAuto = false;
        let simTime = 0;
        let lastRstChange = -999;
        
        const history = [];
        const MAX_HISTORY = 400;
        const VIOLATION_WINDOW = 12; // Frames

        // DOM
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        const btnRst = document.getElementById('btn-rst');
        const relStatus = document.getElementById('release-status');
        
        const wAsync = document.getElementById('w-async');
        const wQ1 = document.getElementById('w-q1');
        const wOut = document.getElementById('w-out');
        const body1 = document.getElementById('ff1-body');
        const body2 = document.getElementById('ff2-body');

        // --- Core Logic ---

        function toggleReset() {
            asyncRstIn = asyncRstIn ? 0 : 1;
            lastRstChange = simTime;
            
            // Async logic: Assertion is immediate
            if (asyncRstIn === 1) {
                ff1 = 1;
                ff2 = 1;
            }

            updateUI();
        }

        function resetLabState() {
            asyncRstIn = 0;
            clk = 0;
            ff1 = 0;
            ff2 = 0;
            simTime = 0;
            lastRstChange = -999;
            history.length = 0; // Clear array
            
            relStatus.innerText = "SAFE";
            relStatus.className = "text-green-400 font-mono font-bold";
            
            updateUI();
            // Clear canvas immediately
            ctx.clearRect(0,0,canvas.width, canvas.height);
        }

        function toggleAuto() {
            isAuto = !isAuto;
            document.getElementById('btn-auto').classList.toggle('bg-indigo-900/40', isAuto);
            document.getElementById('btn-auto').classList.toggle('text-indigo-400', isAuto);
        }

        function pulseClock() {
            if (clk === 0) {
                clk = 1;
                handleClockEdge();
            } else {
                clk = 0;
            }
            updateUI();
        }

        function handleClockEdge() {
            // RELEASE Check
            const delta = simTime - lastRstChange;
            if (asyncRstIn === 0 && delta < VIOLATION_WINDOW) {
                triggerViolation();
            }

            // Sync De-assertion: If reset is 0, shift in '0'
            if (asyncRstIn === 0) {
                ff2 = ff1;
                ff1 = 0;
            }
        }

        function triggerViolation() {
            relStatus.innerText = "METASTABLE RISK";
            relStatus.className = "text-red-500 font-mono font-bold animate-pulse";
            setTimeout(() => {
                if(relStatus.innerText === "METASTABLE RISK") {
                    relStatus.innerText = "SAFE";
                    relStatus.className = "text-green-400 font-mono font-bold";
                }
            }, 2500);
        }

        function updateUI() {
            document.getElementById('val-async').innerText = asyncRstIn;
            document.getElementById('val-clk').innerText = clk;
            
            btnRst.className = asyncRstIn ? "switch-btn btn-rst-on w-full" : "switch-btn btn-rst-off w-full";
            btnRst.innerText = asyncRstIn ? "RELEASE RESET" : "ASSERT ASYNC RESET";

            wAsync.setAttribute('class', "wire " + (asyncRstIn ? "wire-active" : "wire-low"));
            wQ1.setAttribute('class', "wire " + (ff1 ? "wire-active" : "wire-low"));
            wOut.setAttribute('class', "wire " + (ff2 ? "wire-active" : "wire-low"));
            
            body1.setAttribute('class', "ff-box " + (ff1 ? "ff-active" : ""));
            body2.setAttribute('class', "ff-box " + (ff2 ? "ff-active" : ""));
        }

        function step() {
            simTime++;

            if (isAuto) {
                if (simTime % 40 === 0) {
                    clk = !clk;
                    if (clk === 1) handleClockEdge();
                    updateUI();
                }
            }

            history.push({ 
                clk: clk, 
                asyncRstIn: asyncRstIn, 
                ff1: ff1, 
                ff2: ff2 
            });
            
            if (history.length > MAX_HISTORY) history.shift();

            drawWaveforms();
            requestAnimationFrame(step);
        }

        function drawWaveforms() {
            if(canvas.width !== canvas.offsetWidth) canvas.width = canvas.offsetWidth;
            const w = canvas.width;
            const h = canvas.height;
            const stepWidth = w / MAX_HISTORY;

            ctx.clearRect(0,0,w,h);

            const lanes = [
                { id: 'clk', y: 35, c: '#facc15' },
                { id: 'asyncRstIn', y: 85, c: '#f87171' },
                { id: 'ff1', y: 135, c: '#818cf8' },
                { id: 'ff2', y: 185, c: '#4ade80' }
            ];

            lanes.forEach(lane => {
                ctx.strokeStyle = lane.c;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for(let i=0; i<history.length; i++) {
                    const val = history[i][lane.id];
                    const x = i * stepWidth;
                    const y = val ? lane.y - 15 : lane.y + 15;

                    if(i===0) {
                        ctx.moveTo(x, y);
                    } else {
                        if (history[i-1][lane.id] !== val) {
                            ctx.lineTo(x, val ? lane.y + 15 : lane.y - 15);
                        }
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();

                ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, lane.y);
                ctx.lineTo(w, lane.y);
                ctx.stroke();
            });
        }

        updateUI();
        requestAnimationFrame(step);

    </script>
</body>
</html>
